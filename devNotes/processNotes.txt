Process notes for Issue Index Application
==========================================




About Process Notes
===================
"Process Notes" is a step-by-step workflow document that outlines the "phases" of my app development and the successive steps taken at each
milestone of application development. Groups of related steps are combined into "phase" modules so that they can be reorganized and refined 
in post-review. This has proven to be EXTREMELY helpful in learning (i.e. Feynman technique (https://fs.blog/2012/04/feynman-technique/)) 
and refining workflow so I can improve my process in future projects. It also has come in handy for some tricky bug fixes not only for
past projects, but this one as well so I would urge you to consider at least doing a rough summary for your own benefit.





5Q's, Objective and User Story
=========================
[What is the Problem?]: 
You're working on a project and you come across a particular "issue". You do some research, ask colleagues, trial and error and you 
managae to find a solution. Now what if someone else has the same problem? All the work you put into finding the solution on the issue could
end up going to waste.

[Why hasnt the problem been solved?]:
Although glossaries and wikis exist, they often more complicated than what is needed, and if they cost money to run. This is a simple and
straight forward "issue index" with categories and issues filed to those categories. 

[What is Possible?]:
Imagine being able to create a project issue index for free and the latitude to create categories and issues for your project that will Finally
your team in on small issues that get resolved.

[What is different now?]:
Now you can simply create a open source issue index page and post your issues to a growing number of categories.

[What should you do now?]:
Use issue index. with issue index, the user would visit the main page and be presented with recent additions, categories, and individual issues 
to browser. There would be search functionality for categories and issues. The user would have the ability to add categories and issues and have 
the ability to edit or remove categories and issues as well. Additionally, the project will not include user authentication since it is crowdsource 
by nature.






Initial Plan for the App
========================
1. Do basic wireframe for intitial design.
2. Setup the initial conventional structure of the project (basic first, reiterate second, refactor third).
3. Setup database (will use with this project).
4. Add highest level feature "Categories", which will pertain to the related "issues".  
4. Add next level feature "issues", which will then file into categories.  







Process Workflow Summary:
=========================
                                                                                        _____________________________________________                
    Phase 1: Project Setup:                                                                        Project Setup (Phases 1-8)
        1. Project Setup.                                  
        2. Install Express.                                                  
        3. Add .gitignore.                                                               
        4. Add custom start scripts.
        5. Add server.js.

    Phase 2: Create express app:
        1. Setup express.
 
    Phase 3: Setup MVC and public files:
        1. Create MVC folder.
        2. Create public folder.
   
    Phase 4: Setup server:
        1. Create server.
        2. Run server.
        3. Test server in browser.

    Phase 5: Create a Router:
        1. Create "route" file in router folder.
        2. Setup router file.
        3. Hook-up "index.js" to "server.js".
        4. Test router.
        
    Phase 6: Configure EJS:
        1. Install EJS.
        2. Set EJS as the view engine.
        3. Load and use express-ejs-layouts.
   
    Phase 7: Setup views and layouts:
        1. Set views.
        2. Set layouts.

    Phase 8: Integrate routes with views:
        1. Create layout "view" file.
        2. Create HTML template for primary layout view.
        3. Insert EJS element for future page content.
        4. Create an index.js controller in "views"
        5. Integrate the route with the view.
        6. Test the integration.
                                                                                        _________________________________________________
    Phase 9: Integrate Mongoose:                                                                     Setup database (Phase 9)
        1. Setup mongoose on server.js.                                          
        2. Setting up connection to database with .env file.                     
                                                                                        __________________________________________________                                              
    Phase 10: Add "category" controllers and views:                                          Add Category functionality (Phase 10-16)
        1. Create an "category" Router.
        2. Setup category routes.
        3. Create views for category routes.
        4. Hook up "categoryRouter" to server.js.
        5. Test categoryRouter.

    Phase 11: Create and include partials in layout:
        1. Create "partials" folder in views.
        2. Create initial partial files (i.e input field).
        3. Include partial files in layout.

    Phase 12: Create Category model:
        1. Create models folder.
        2. Create a "category.js" file in "models".
        3. Load mongoose.
        4. Create a schema for "categorySchema".
        6. Create a model for "Category".
        7. Export the Category model.
        8. Import Category model to "categories.js".
        9. Use the model in your route.

    Phase 13: Create form and input partial for Category (for nav):
        1. Add form to new.ejs.
        2. Create partial file for form field.
        3. Create a label form field.
        4. Import the form partial to category.js.

    Phase 14: Configure "create category" route:
        1. Install and configure body-parser via npm.
        2. Test "Create Category Route".

    Phase 15: Build Create Category Route:
        1. Configure "Create Category Route".
        2. Create error message partial.
        3. Add async to the "Create Category Route".

    Phase 16: Display All categories feature to app:
        1. Add async to All Categories route.
        2. Create view for all categories.
        3. Implement search feature for categories.
        4. In index.js, add searchOptions as a value to the form.
                                                                                         _________________________________________________
    Phase 17: Add "Issue" controller and views:                                                 Add Issue functionality (Phase 17-20)
        1. Create a "issues.js" router.
        2. Create an "issue" model.
        3. Hook-up "issueRouter" to server.js.
        4. Add Issue links to header.js
        5. Test issueRouter.

    Phase 18: Add "new issues" to views:        
        1. Create an "issues" file.
        2. Create a "new.ejs" file for new issues.
        3. In issues router, add new issue route.
        4. Add form field partial for issue _form_fields.ejs.
        5. In issues router, add new issue route.
        6. Complete form field partial for add issue.
        7. Hookup issue form to route. 

    Phase 19: Setup file uploading:
        1. Install multer.
        2. Add enctype to "add issue" form.
        3. Import multer to issues.js.
        4. Configure upload to use multer.
        5. Create a basepath for uploaded images in issue.js model file.
        6. Setup route to accept files.
        7. Test add issue.
        8. Add logic to remove issue images that are not in the database.

    Phase 20: Setup "All Issues" page:
        1. Copy the same code from the Category index.js file. 
        2. Implement logic for issues route.
        3. Add search to issues.
                                                                                         _________________________________________________                    
    Phase 21: Build out initial code for main page:                                           Add Initial Main page features (Phase 21)
        1. Add initial code and "recents" logic.
        2. Add issues to main index.js.
        3. Add logic to sort most recent logic.
        4.  Add logic to index.ejs.
                                                                                         _________________________________________________
    Phase 22: Enable file upload to database.                                                 Add file upload feature (Phase 22-)
        1. Setup filepond.
                                                                                         __________________________________________________
    Phase 23: Create show, edit, update, and delete routes for categories                     Add CRUD operations to categories
    Phase 24: Install "method override" library that allows put and delete requests:
    Phase 25: Create Edit page
    Phase 26: Create Update page
    Phase 27: Create Delete page
    Phase 28: Create a pre method to account for issues using categories you may still be using.
    Pahse 29: Create show page



Phase 1: Project Setup
=========================================================================================
-- Setting up your project lays the foundation for the rest fo the project. The initial 
   steps involve installing npm, dependencies, development environment setup, and 
   essential files like server.js, .gitignore, and .env.
=========================================================================================

/// Project Setup:                           
        1.1:  Issue-Index-App                                     -- Create a folder to store you application.
        1.2:  npm init                                            -- Create a package.json file to start the project off.

/// Install express:
        1.3:  npm install express                                 -- Install express.
        1.4:  .gitignore > node_modules                           -- Tell git to ignore node_modules folder.

/// Install developer environment:                
        1.5:  npm install --save-dev dotenv nodemon               -- Install development enviroment.

/// Create custom "devStart" script in package.json:     
        1.6:  "devStart": "nodemon server.js"                     -- Run development environment (npm run devStart).
        1.7:  "start": "node server.js"                           -- Run server normally in a production environment (npm run start).
        
/// Create initial application files:       
        1.8:   server.js                                          -- Create main server file.
    
    
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes: 
            * 1.2 -- Dont breeze through the npm init stage, take the time to setup the project correctly (i.e. server.js instead of index.js, etc.)
            * 1.4 -- Submit everything AFTER you create the .gitignore file and add node_modules.
            * 1.6 -- Install a developer enviroment as good practice, it makes things a lot easier in development even if you end up not using it.    
            * Note -- You can have multiple custom scripts. 

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////    





Phase 2: Create express app
=============================================================================================================
-- Create express application, import initial "set" configuration settings and middlewares.
=============================================================================================================

/// Setup express application...
        ==================================================================
        * When you import libraries, you are essentially importing the 
          packages you have installed via npm. To use exprees, you simply 
          need to load it and instantiate it.
        ==================================================================
        
    2.1: Setup express:
        ---------------------------------------------------------
                const express = require('express');                     -- Imports express from express library.
                const app = express();                                  -- Get the app portion from the express librrary to instantiate the app.
        ---------------------------------------------------------      


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes: 
            * 2.1 -- When you import libraries, you are essentially importing the packages you have installed via npm.
            * 2.1 -- These are not the only libraries added nore the only middleware to be used. However, I find it easier to load the intial 
                     libraries first and then add in libraries as you go along (i.e. mongoose, etc.) because then you can keep track of the process 
                     and make sure you dont miss anything.          

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////    





Phase 3: Setup MVC and public files
==========================================================================================================
-- For larger applications, use MVC (Model View Contoller) file structure for efficientcy and consistency.
==========================================================================================================

/// Setup MVC file structure... 
        ==============================================================================
        *  Model View Controller is a design pattern for our application. Currently, 
           we have View (i.e. "views" folder) and Controller (i.e. "routes" folder). 
           You'll also need a Model ("models" folder) eventually to house all our 
           database models to complete the design pattern.
        ==============================================================================
        
        3.1: Create MVC folders:
                --------------------
                    models            -  (M)odels
                    views             -- (V)iews
                    routes            -- (C)ontroller 
                --------------------


/// Setup a "public" file...
        =================================================================================
        * The "public" folder is used to store and serve static files, like stylesheets, 
          javascript, images, etc. Anything initially requested clientside goes here.
        =================================================================================
                
        3.2 Create and use public folder:          
                ---------------------------------------------------------
                        app.use(express.static('public'));                      -- Tell express all public files kept in public folder.
                ---------------------------------------------------------    
                --------------------------------------------------------
                        public                                                  -- Create folder for storing static assets.
                ---------------------------------------------------------

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:             
          * 3.1 -- The "models" folder will contain mongoose schemas and models.
          * 3.1 -- The "views" folder will contain different views of the files (i.e. ejs files, etc).
          * 3.1 -- The "routes" folder will contain controllers (i.e. CRUD routes) 

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////  





Phase 4: Setup server
=============================================================================================================
-- Create a server to listen on a given port and test the connection to ensure working functionality.
=============================================================================================================

/// Create server...
        ==================================================================
        * Although there are different ways to setup a server, the method
          below is best for eventual integration testing.
        ==================================================================
        
        4.1: Create server:
            ----------------------------------------------------------
                    let server; 
                    server = app.listen(3000, function() {   
                        console.log(`Listening on port 3000...`);   
                    });
            ----------------------------------------------------------
      

/// Test your server...
        ======================================================
        * Use "npm run devStart" for developer environment.
        * Use "npm run start" for production environment.
        ======================================================
        
        4.2: Run your application:
            -----------------------------------------------------------------------
                    $ npm run devStart

                    > basic-blog-app@1.0.0 devStart C:\Users\Admin\Issue-Index-Application
                    > nodemon server.js

                    [nodemon] 2.0.2
                    [nodemon] to restart at any time, enter `rs`
                    [nodemon] watching dir(s): *.*
                    [nodemon] watching extensions: js,mjs,json
                    [nodemon] starting `node server.js`
                    Your app is listening on port 3000
            -----------------------------------------------------------------------


        4.3: Test your application in browser:
            * And when you go to "localhost:3000", you should see "Cannot GET /", which means that the server is working,
              but no routes are present yet! 


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:       
            * 4.1 -- So for the intial set-up of the server, you can initially setup a basic app.listen and the port number. However, if
                     you want to run integration tests later, you will need to configure your server in a more complex way. Procedurally, 
                     it makes the most sense when I get to this point to then add in the elements that will make this work now. 

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





Phase 5: Create a Router
=============================================================================================================
-- Because this application is going to larger, we want to create a "Router" that modularizes all the routes
   that we'll have for the application and keep our server.js file clean.
=============================================================================================================

/// Create a route file in router folder...
        ================================================================================
        * Earlier we created our MVC file structure with a "routes" folder. This routes
          folder is going to hold all the routes we wish to modularize to help keep our
          server.js file clean. To start off, we'll create an index.js file to handle
          the catch-alls... that is, everything else unspecified for the app.
        ================================================================================
        
        5.1: Create an "index.js" route inside the "routes" folder:
            -----------------------------------------------------------------
                    routes  >  index.js                                             -- "index.js" route created for catch-alls in "routes" folder.
            -----------------------------------------------------------------
        

/// Setup router file...
        ================================================================================
        * For each router file you create, you need to load express, the router portion
          of express, and export the module (i.e. this "index.js" file) to server.js.
        ================================================================================
        
        5.2: In index.js, setup the router by loading express, router, and export:
            -----------------------------------------------------------------
                    const express = require('express');                             -- Load express.
                    const router = express.Router();                                -- Load router portion of express.

                    ...
                    ...
                    ...

                    modules.exports = router;                                       -- Export the module "router" (which will hook up to "router" in server.js).
            -----------------------------------------------------------------

        5.3: Create a test route to the root of the application (i.e. '/'):
            -----------------------------------------------------------------
                    router.get('/', function(req, res) {                            -- This route should return "This is a test" in your localhost root request.
                        res.send('This is a test');
                    });
            -----------------------------------------------------------------


/// Hook-up "index.js" to "server.js"...
        =============================================================================
        * Essentially, once you have the router setup correctly, you can link it to 
          the server.js file so that you have full use of the seperate route module.
        =============================================================================
        
        5.4: Load "index.js" to "server.js":
            -----------------------------------------------------------------
                    const indexRouter = require("./routes/index");                  -- Hooks up application to the index.js file in the routes folder.
            -----------------------------------------------------------------

        5.5: Add indexRouter middleware so that the application can use it:
            -----------------------------------------------------------------
                    app.use("/", indexRouter);                                      -- Middleware says that for root request, use indexRouter.
            -----------------------------------------------------------------


/// Test router...
        ==================================================
        * To test, go to localhost:3000 in your browser. 
        ==================================================
                   
        5.6: Test the route.    
            -----------------------------------------------------------------
                    localhost:3000   >   This is a test
            -----------------------------------------------------------------


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:
            * 5.1 -- Use "index.js" in "routes" as a catch-all for everything that doesnt have a resource or a model.
            * 5.1 -- Create a Router with a routes folder and initial route file index.js to better organize 
                     the routes we have instead of collecting everything in the server.js folder. 
            * 5.4 -- When assigning the name as "indexRouter" and as a value pass in the relative path (i.e. "./routes/index"), note that "./" is 
                     relative to where the route is. Also notice when you put in the initial relative path (./), intellesense will show you the folders 
                     and the file.
            * Note -- For more information on express router, see my study that outlines a basic setup: https://github.com/john-azzaro/Study-Express-Router
                    
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





Phase 6: Configure EJS
=============================================================================================================
-- For this application, we're going to be using a template engine called ejs that will allow us to reuse
   our HTML over many pages without having to repeat our code. In order to use EJS, we need to configure
   the app to use EJS in server.js.
=============================================================================================================

/// Install EJS dependency via npm...
        =====================================================================
        * Installing ejs and express-ejs-layouts as well as setting the view 
          engine to ejs will allow you to use ejs in your application.
        =====================================================================

        6.1: Install ejs and express-js-layouts with npm:   
            -----------------------------------------------------------------
                    npm install ejs express-ejs-layouts                             -- Npm install of "ejs" and "express-ejs-layouts"                                                                
            -----------------------------------------------------------------
        

/// Set EJS as the view engine...
        ========================================================================
        * Layouts enable us to dynamically fix content or elements to a page 
          in such a way that even if a different page is requested, the content 
          remains but the page is successfully accessed.
        ========================================================================
        
        6.2: Set view engine to ejs: 
            -----------------------------------------------------------------
                    app.set("view engine", "ejs");                                  -- Set the view engine to ejs.
            -----------------------------------------------------------------


/// Load and use express-ejs-layouts...
        ========================================================================
        * expressLayouts is going to allow us to create a layout file for all
          the HTML in the app.
        ========================================================================
        
        6.3: Import expressLayouts:
            -----------------------------------------------------------------
                    const expressLayouts = require('express-ejs-layouts');          -- Import the express layouts package.
            -----------------------------------------------------------------  

        6.4: Use express layouts (middleware):
            -----------------------------------------------------------------
                    app.use(expressLayouts);                                        -- Tell the application that we want to use "express layouts"
            -----------------------------------------------------------------


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:
            * Note -- When you configure your app, you are setting the settings such as the behavior of the app (in 
                      the case of views and view engines), etc. You use the "app.set()" and assign a name and a value.
            * Note -- Since I like to do things organically with application development, I thought it best to install ejs in full 
                      in a later phase. In the case of this project, we want to use a template engine (ejs) and be able to have a 
                      layout file for our HTML (express-ejs-layouts).   
            * Note -- Before you begin using ejs with your app, make sure you have the ejs language support installed in VSCode.
            * Note -- For more information on EJS, see my template engine study: https://github.com/john-azzaro/Study-Template-Engines   

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





Phase 7: Setup views and layouts.
================================================================================================================
--  Setting up views and layouts by hooking up "views" folder and setting layouts/layout as the central layout.
================================================================================================================

/// Set views...
        ============================================================================
        * Since we've already created the "views" folder as part of out MVC 
          design pattern, what want to hook these folders and files up so when
          we start using ejs in the next phase, everything will function correctly.
        ============================================================================ 

        7.1: Set location of views folder:       
            -----------------------------------------------------------------
                app.set("views", __dirname + "/views");                         -- Sets views to draw from "views" folder (which we made for our MVC pattern). 
            -----------------------------------------------------------------  
    

/// Set layouts...
        ==============================================================================
        * And to set layouts, we set where the layouts file is going to be. The idea
          behind the layouts file is that all the HTML we create for the app will go 
          in the layouts file so we dont have to duplicate the same HTML over and over.
        ==============================================================================

        7.2: Set "layouts" file in "views":
            -----------------------------------------------------------------
                        app.set("layout", "layouts/layout");                            -- Sets layout file so you can reuse HTML like the header and the footer.
            -----------------------------------------------------------------

        7.3: Create "layout" folder inside "views" folder:
            * This folder will hold the layouts for our app.
            -----------------------------------------------------------------
                        views  >  layouts                                               -- "layouts" subfolder in views to hold the layouts for our app.
            -----------------------------------------------------------------


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:
            * Note -- Since I like to do things organically with application development, I thought it best to install ejs in full 
                      in a later phase. In the case of this project, we want to use a template engine (ejs) and be able to have a 
                      layout file for our HTML (express-ejs-layouts).   
            * Note -- Before you begin using ejs with your app, make sure you have the ejs language support installed in VSCode.
            * Note -- For more information on EJS, see my template engine study: https://github.com/john-azzaro/Study-Template-Engines
            * 7.1 --  You could also do path.join(__dirname, '/views') depending on your preference.    

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





Phase 8: Integrate routes with views.
=============================================================================================================
--  Now that we've created a seperate "routes" module (since this will be a large app necessitating the 
    relocation of routes from server.js to "routes" folder) and setup the app to use EJS, we now need to
    create reusable blocks of HTML code so that dont have to create duplicate code for each one of our pages.
=============================================================================================================

// Create layout "view" file...
        ==============================================================================
        * In the case of "layout.ejs", we are creating a primary "view" which is the
          primary HTML document that our entire application will use. This comes in 
          handy because we dont have to repeat the code over and over again, we will
          just need to insert the different pages inside this layout view.
        ==============================================================================

        8.1: Create a "layout.ejs" file inside the new layouts subfolder:
            -----------------------------------------------------------------
                    views  >  layouts  >  layout.ejs                             -- "layout.ejs" for global boilerplate HTML for every page in the application.
            -----------------------------------------------------------------


// Create HTML template for primary layout view...
        ========================================================================
        * The "layout.ejs" document will be the central HTML document that will 
          wrap around all of the pages we create for the app, allowing us to have 
          one file for multiple pages and help with edits, bugs, etc. 
        ========================================================================

        8.2: In layout.ejs, insert your HTML template:
        ------------------------------------------------------------------
                <!DOCTYPE html>                                                 -- Boilerplate HTML that will wrap around every page in the application.
                <html lang="en">
                <head>
                    ...meta...
                </head>
                <body>
                </body>
                </html>
        ------------------------------------------------------------------
    

// Insert EJS element for future page content...
        =========================================================================
        * 
        =========================================================================
        
        8.3: Insert EJS "body "element for page specific content:
            * Inside the body, using <%-  and %> tags will utilize ejs.
            ------------------------------------------------------------------
                    <!DOCTYPE html>                                            
                    <html lang="en">
                    <head>
                        ...meta...
                    </head>
                    <body>

                        Before                                                     -- "Before" added for testing.
                        <br>

                        <%- body %>                                                -- All page specific content will be included "body" element.
                        
                        <br>
                        After                                                      -- "After" added for testing.

                    </body>
                    </html>
            ------------------------------------------------------------------    


// Create an index.js controller in "views"...
        ==================================================================================
        * This step is essentially to test that the views are integrated with the router.
        ==================================================================================
        
        8.4: Create a "index.ejs" file in "views" and test.
            ------------------------------------------------------------------
                    views  >  index.ejs                                            --"index.js" inside the "view" folder (note: add "middle" text to test).
            ------------------------------------------------------------------ 


// Integrate the route with the view...
        ====================================================================================
        * Finally, this is the point where you integrate the route (in "index.js") with the
          view (in index.ejs). 
        ====================================================================================
        
        8.5: Replace "send" with "render" in index.ejs route and pass in the view (i.e. index):
            
            ------------------------------------------------------------------
                    router.get('/', function(req, res) {
                        res.render('index');                                        -- "res.send" changed to "res.render" with the name of the view.
                    });
            ------------------------------------------------------------------


// Test the integration...
        ===============================================================================
        * When you test the connection, you will see whether or not the routes
          and views have been successfully integrated.
        ===============================================================================
    
        7.8: Test in localhost:3000
            ------------------------------------------------------------------
                    Before                                                          -- "Before" is in layout.ejs view.
                    Middle                                                          -- "Middle" is in index.ejs view.
                    After                                                           -- "After" is in layout.ejs view.
            ------------------------------------------------------------------


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:
            * 8.1 -- The HTML boilerplate is not ejs specific... this is just a standard HTML template that will be shows for every page in the app.
                     In other words, we only have to do this template ONCE and reuse it for each page in our application.
            * 8.2 -- To insert the page specific, we simply need to insert an ejs element and assign it the name body: <%- body %>.
                      
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





Phase 9: Integrate Mongoose
=========================================================================================================
    * Because we want to store the information in a database (e.g. mongoDb) instead of keeping the database
      in local storage where it will be lost, we need to utilize mongoose, which will provide a modeling 
      environment for our data and enforce structure (models) and maintain flexibility.
=========================================================================================================

// Setup mongoose on server.js...
        ===================================================================================================
        * Installing mongoose here instead of initially in the project setup seems better so that you make
          sure you are following a topic-specific procedure.
        ===================================================================================================

        9.1: Install mongoose dependency via npm:
            -----------------------------------------------------
                    npm install mongoose
            -----------------------------------------------------

        9.2: Load Mongoose in server.js:
            -----------------------------------------------------
                    const mongoose = require('mongoose');             -- added mongoose library to the imports.
            -----------------------------------------------------

        9.3: Configure mongoose to use ES6 promises:
            -----------------------------------------------------
                    mongoose.Promise = global.Promise;                -- makes sure mongoose can use ES6 promises.
            -----------------------------------------------------
        

// Setting up connection to database with .env file...
        =======================================================================================================
        * There are a few methods I know for setting up connection to a database. The first via dotenv is a more 
          simplistic connection but it will not handle integrated testing easily. The second via config file will
          handle integrated testing but it is a bit more involved, so choose which one fits your project. For this 
          project I'll do both so you can choose what suits you.
        =======================================================================================================

        9.4: Connect mongoose:
            -----------------------------------------------------------------
                    mongoose.connect(process.env.DATABASE_URL, {                 -- mongoose connects to URL stipulated in the .env file. 
                        useNewUrlParser: true,  useUnifiedTopology: true         -- use new url parsser and unified topology.
                    });
            -----------------------------------------------------------------

        9.5: Determine if we are connected to database:
            ----------------------------------------------------------
                    const db = mongoose.connection;                               -- Access the connection
                    db.on('error', function(error) {                              -- If there is an error connecting to db, return error.
                    console.error(error) 
                    });
                    db.once('open', function() {                                  -- If connection is successful, log success message in the console.
                    console.log('Connected to mongoose...');
                    });
            ----------------------------------------------------------
        
        9.6: Install dotenv via npm to development environment:
            ----------------------------------------------------------
                    npm install --save-devdotenv                                  -- library allows you to load environment variable into the application.
            ----------------------------------------------------------

        9.7: Create a .env file:
            ----------------------------------------------------------
                    .env                                                          -- the ".env" file will house all the different variables.
            ----------------------------------------------------------

        9.8: Create DATABASE_URL in .env:
            ----------------------------------------------------------
                    DATABASE_URL=mongodb://localhost/issueindex                   -- The variable "DATABASE_URL" will use mongodb, local host, and the database name "issueindex"
            ----------------------------------------------------------

        9.9: In server.js, check to see if you are in the production environment:
            ----------------------------------------------------------
                    if (process.env.NODE_ENV !== 'production') {                 -- if process.env.NODE_ENV is NOT equal to production, load dotenv
                       require('dotenv').config();    
                    }
            ----------------------------------------------------------


// Create config.js file for database and ports...
        ==================================================================================================
        * To be added later.
        ==================================================================================================


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        Notes:
            * Note -- From my experience, there are a few ways to setup mongoose for the app. The first is using a .env file and the second is 
                      with a config file. Additionaly, if you want to have integrated testing, youll need to incorporate runserver and endserver 
                      functions to the server process.
                      
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






Phase 10: Add "catagory" controlles and views.
==========================================================================================================
* One of the key features of this app is the categories that we can file our issues to. I found it best to 
  start off with the higher level routes first (i.e. categories) and then get into the granular parts of
  each category (i.e. issues). As part of the categories features, we want to create, search, and view the 
  categories in a new router.
==========================================================================================================

// Create a "category" Router...
        ======================================================================
        * To create a new controller in our routes folder, you basically have
          repeat the same process we did for index.js in creating a router. If
          just do a copy/paste because the "all" categories route is almost exactly
          the same as what we already have in the index.js route. Saves some time.
        ======================================================================
        
        10.1: Create an "category.js" in "routes":
             ----------------------------------------------------------------
                     category.js                                                      -- new router created in the routes file.
             ----------------------------------------------------------------

        10.2: Setup a router for "category.js":
             ----------------------------------------------------------------
                     //Imports
                     const express = require('express');                               -- Import express.
                     const router = express.Router();                                  -- Load router portion of express.

                     // Routes

                     //Export
                     module.exports = router;                                          -- Export the module "router" (which will hook up to "router" in server.js).
             ----------------------------------------------------------------

// Setup category routes...
        ======================================================================
        * This step will cover all the routes we'll need for the categories.
          For each category route we want to create, we'll want to render the
          layout in a "categories" folder. You can see here that for each new
          route class, you'll want to have a seperate folder for organizational
          purposes.
        ======================================================================
        
        10.3: Create "all categories" route:
             ----------------------------------------------------------------
                     // Routes
                     router.get('/', function(req, res) {                              -- get all categories at the root endpoint.
                        res.render('categories/index');
                     });
             ----------------------------------------------------------------

        10.4: Create a new "category" page route:
             ----------------------------------------------------------------
                     router.get('/new', function(req, res) {
                        res.render('categories/new');                                   -- this will DISPLAY the form to create the new category.
                     });   
             ----------------------------------------------------------------

        10.5: Create a new "Category":             
             ----------------------------------------------------------------
                     router.post('/', function(req, res) {
                         res.send('Create');                                           -- this will POST (i.e. send) to the collection to create a new category.
                     });
             ----------------------------------------------------------------


// Create views for category routes...
        ======================================================================
        * With the routes done, we need to create the views for the category 
          routes so that we have something to render when the client requests
          the given url. Note here that we're going to create 2 ejs files for 
          our 3 routes. Why? Because the "create" a new category does NOT render 
          anything to the app.
        ======================================================================

        10.6: In views, create files for all categories and new category page with test text:
             -----------------------------------------------------------------
                      index.js       >  "All categories"                               -- File will render the view for ALL categories.
                      new.ejs        >  "New category"                                 -- File will render the view for new category creation.
             -----------------------------------------------------------------


// Hook up "categoryRouter" to server.js...
        ======================================================================
        * Hook up the categories router to server.js.
        ======================================================================

        10.7: In server.js, import "categoryRouter":
             -----------------------------------------------------------------------
                      const categoryRouter = require('./routes/categories/');             -- Router hookedup between router > categories and server.js.
             -----------------------------------------------------------------------

        10.8: Use categoryRouter in the app:
             -----------------------------------------------------------------------
                      app.use('/categories', categoryRouter);                             -- every route in "categoryRouter" is going to be prepended with "categories"
             -----------------------------------------------------------------------

// Test categoryRouter...
        ============================================================================
        * When you test the router connection, you should see that when you go
          to the localhost:3000/categories, the "middle" part holds your categories.
        ============================================================================

        10.9: Test route at localhost:3000/categories:
             -----------------------------------------------------------------------
                     Beginning                Beginning            
                     All categories           New Category
                     After                    After
             -----------------------------------------------------------------------





Phase 11: Create and include partials in layout
========================================================================================
* Partials contain all the template files that are NOT connected to routes such as 
  headers, footers, etc. The awesome thing about EJS is that you can utilize your ejs 
  files as smaller, more versatile modules. Ive also found that using partials is really
  handy if you have a more fluid design sense and evolve the UI/UX oduring development.
* Note that when you create partial files, you want to use as a naming convention 
  underscores (i.e. _) to show that it is a partial file and not a full file being 
  rendered from the server.   
=========================================================================================

// Create "partials" folder in views...
        =============================================================================
        * First thing you need to do is create a partials folder to store all your 
          partial ejs templates.
        =============================================================================

        11.1: Create a "partial" file in "views":
             ----------------------------------------------------------------------
                     views  >  partials                                                   -- "partials" will contain all the template files NOT associated with routes.
             ----------------------------------------------------------------------


// Create initial partial files...
        =============================================================================
        * Initially, we'll want to create a header.js in our partials folder so we 
          avoid manually inputting routes each and every time. Again, the design of
          the header and other partials is not vitally important is you have an organic
          design process, this is just extremely convienient for development.
        =============================================================================

        11.2: Create a "header.js" file in the partials folder:
             ----------------------------------------------------------------------
                     partials  >   header.ejs                                             -- "header.ejs" will be the initial primary template for the header of the application.
             ----------------------------------------------------------------------

        11.3: In header.js, create a basic header with nav:
             ----------------------------------------------------------------------
                     <header>
                        <nav>
                           <a href="/">IssueIndex</a>                                      -- anchor tag that directs to home.
                           <ul>
                              <li><a href="/categories">Categories</a></li>                -- anchor tag that directs to the categories page.
                              <li><a href="/categories/new">Add Category</a></li>          -- anchor tag that directs to the Add Category page.
                           </ul>
                        </nav>
                      </header>
             ----------------------------------------------------------------------


// Include partial files in layout...
        =============================================================================
        * And at last, you take the header partial you just created and "include" it
          in your main layouts.ejs HTML file. To do this, you find a spot in your HTML
          you want the partial to be and simply call include inside an ejs tag and
          pass the route to the partial file. Note that because the partials file is 
          nested inside views, you need to add two dots before partials/header.ejs
        =============================================================================
        
        11.4: "Include" the partial module in the layouts.ejs file:
             ----------------------------------------------------------------------
                     <%- include('../partials/header.ejs') %>                            -- "include" the header.ejs partial file in layouts.ejs.
                     <%- body %>
             ----------------------------------------------------------------------




Phase 12: Create Category model
====================================================================================
* To start creating true functionality with our application, we first need to create
  models and schemas that mongoose will use. Check out my outline on mongoose models 
  and schemas here: https://github.com/john-azzaro/Study-Mongoose-Schemas . Also, check 
  out https://github.com/john-azzaro/Study-Mongoose-Configuration-and-Data-Modeling 
  for more information on mongoose foundational information.
====================================================================================

// Create models folder...
        ============================================================================
        * Creating a "models" folder is part of the overall MVC file structure where
          for items saved to the mongodb database.
        ============================================================================

        12.1: Create "models" folder:
             ------------------------------------------------------------------------
                        models                                                                  -- the M in MVC!
             ------------------------------------------------------------------------


// Create a "category.js" file in "models"...
        =============================================================================
        * This model file will conatin the schemas, models, instance methods, embedded
          models, etc. for "category".
        =============================================================================
        
        12.2: Create "category.js" file:
             ------------------------------------------------------------------------
                        category.js                                                              -- model and schema for categories.
             ------------------------------------------------------------------------


// Load mongoose...
        =============================================================================
        * Our model and schema will utilize mongoose to interact with mongodb database.
        =============================================================================

        12.3: Load mongoose:
             ------------------------------------------------------------------------
                        const mongoose = require('mongoose');                                    -- use mongoose for category.js
             ------------------------------------------------------------------------ 

        
// Create a schema for "categorySchema"...
        ==============================================================================
        * A schema will define the shape of the documents we have within a collection
          in mongodb. At this point, we are going to create a category schema.
        ==============================================================================

        12.4: Create a category schema:
              ------------------------------------------------------------------------
                        const categorySchema = new mongoose.Schema({                             -- new schema named "categorySchema" with...
                            name: {                                                              -- The Category needs a name...
                              type: String,                                                      -- which is a string...
                              required: true,                                                    -- and is required.
                            }
                        });
              ------------------------------------------------------------------------


// Create a model for "Category"...
        ===============================================================================
        * Now that you have a schema, you need to essentially wrap the schema in a model.
          Remember that a schema defines the structure of a document like default values,
          etc., but the model provides the interface to the database for creating, 
          querying, updating, and deleting.  
        ===============================================================================

        12.5: Create a model for the categorySchema:
                -----------------------------------------------------------------------
                        const Category = mongoose.model('Category', categorySchema);             -- Category is categorySchema.
                -----------------------------------------------------------------------


// Export the Category model...
        ================================================================================
        * In order to use the model elsewhere in your code, you need to export it using
          module.exports. A good way to do this is via destructuring syntax. Once this is
          done we can then import the model to create new categories.
        ================================================================================

        12.6: Export the model:
                ------------------------------------------------------------------------
                        module.exports = { Category };                                            -- export Category model.
                ------------------------------------------------------------------------


// Import Category model to "categories.js"...
        =================================================================================
        * Back in routes > categories.js, we need to import the model to use. This will
          give you access to the Category model
        =================================================================================

        12.7: Import model to "categories.js":
                -------------------------------------------------------------------------
                        const { Category } = require('../models/category');                       -- Imported "Category" from models/category (note ../ for model folder nesting).
                -------------------------------------------------------------------------


// Use the model in your route...
        =================================================================================
        * Now that you successfully imported the model to your routes > categories.js file, 
          you can freely use it in your routes. In the case below, we can now create a new
          category at the endpoint. Note that this does NOT save anything to the database
        =================================================================================

        12.8: In the new Category route, add your model:
                -------------------------------------------------------------------------
                        router.get('/new', function(req, res) {
                           res.render('categories/new', { category: new Category() });            -- The "category" variable will be passed to the ejs file
                        });
                -------------------------------------------------------------------------
                
                



Phase 13: Create form and input partial for Category
========================================================================================
* Now that we have the model and route done, we need to create a form so that we can 
  give the user the ability to add a catagory.
========================================================================================

// Add form to new.ejs...
        ================================================================================
        * The form uses a basic HTML form layout with a button for submission and an 
          anchor link for canceling the submission.
        ================================================================================

        13.1: Create New Category form:
                ------------------------------------------------------------------------
                        <h2>New Category</h2>
                        <form action="/categories" method="POST">                                 -- Form with action is the url the form goes to.
                        // Input goes here.
                        <a href="/categories">Cancel</a>                                          -- Anchor tag (used to link) Cancel sends us back to categories.
                        <button type="submit">Create</button>                                     -- Button (used to interact with form) submit the category submission.
                        </form>

                ------------------------------------------------------------------------


// Create partial file for form field...
        ================================================================================
        * You could put in an input here in the form, but since the form will be shared 
          with edit as well, so instead of duplicating the code we can just create a partial
          and use it in both places! This is how the server gets the data from the object,
          what the "name" is is what will be the input to the server.  when we get this back, 
          all we need to do is call body.name to get the input value.
        ================================================================================

        13.2: Create a partial file for form fields:
                ------------------------------------------------------------------------
                        _form_fields.ejs                                                          -- Form fields file (using underscores).
                ------------------------------------------------------------------------


// Create a label form field...
        ================================================================================
        * This is how the server gets the data from the object, what the "name" is is 
          what will be the input to the server.  when we get this back, all we need to 
          do is call body.name to get the input value. Note that for the ejs tag, the "="
          in <%= category.name %> means that what follow the "=" will be output as html
          to the page.
        ================================================================================

        13.3: Add your form in _form_fields.ejs:
                -------------------------------------------------------------------------
                        <label>Name</label>
                        <input type="text" name="name" value="<%= category.name %>" >              -- Form partial with category name. 
                -------------------------------------------------------------------------


// Import the form partial to category.js...
        =================================================================================
        * Once you have the partial completed, you can import it to the category.js file.
        =================================================================================

        13.4: Import form partial:
                -------------------------------------------------------------------------
                        <h2>New Category</h2>
                        <form action="/categories" method="POST">
                           <%- include('_form_fields') %>                                          -- Include the form partial in the new Category page.
                           <a href="/categories">Cancel</a>
                           <button type="submit">Create</button>
                        </form>
                -------------------------------------------------------------------------





Phase 14: Configure and test "create category" route...
        =================================================================================
        * With the input field partial completed, you can now setup the create category 
          route to accept and parse text as json or urls for the form.
        =================================================================================

// Install and configure body-parser via npm...
        =================================================================================
        * So body-parser is a middleware that extracts the entire body portion of an 
          incoming request and exposes it on req.body which is very easy to interface 
          with.
        =================================================================================

        14.1: Install body-parser via npm:
                -------------------------------------------------------------------------
                        npm install body-parser                                                   
                -------------------------------------------------------------------------

        14.2: Configure body-parser in server.js:
                -------------------------------------------------------------------------
                        const bodyParser = require('body-parser');                                  -- Load body-parser to server.js
                -------------------------------------------------------------------------

        14.3: Tell express how to use body-parser via middleware:
                -----------------------------------------------------------------------------
                        app.use(bodyParser.json());                                                 -- Bodyparser middleware that can parse text as JSON and exposes the resulting object on req.body.
                        app.use(bodyParser.urlencoded( { limit: '10mb', extended: false}));         -- Bodyparser middleware that can parse text as url for form (& limited to 10mb for uploading files to server)
                -----------------------------------------------------------------------------


// Test "Create Category Route"...
        ===================================================================================
        * Now that you can text as json via body-parser, you can change the create category
          route to parse the form text in a simple and straight forward way. Once this is 
          done, you can use the input name to create a new category and add it to the 
          database. When you test, you should be able to enter a string in the input, submit 
          it, and a page with the string you entered will appear.
        ===================================================================================
        
        14.4: Amend "create category route":
                ---------------------------------------------------------------------------
                        // Create Category Route
                        router.post('/', function(req, res) {
                           res.send(req.body.name);                                                  -- with the help of body-parser, you can extract the name from the request body.
                        });
                ---------------------------------------------------------------------------





Phase 15: Build Create Category Route...
        ====================================================================================
        * Once you've tested the Create category route, you can build the route out. You can
          go about it with either promises or async/await. async/await tends to be easier for
          me to work with, but promises work just as well. If you want find out more, check out
          my async study: https://github.com/john-azzaro/Study-Asynchronous-Programming-in-Node
        ====================================================================================

// Configure "Create Category Route"...
        ====================================================================================
        * If the test is successful, you can start to add the code needed to add a new 
          category name and add it to the mongodb database.
        ====================================================================================

        15.5: Create a variable "category" set to new category:
                ---------------------------------------------------------------------------
                        // Create Category Route
                        router.post('/', function(req, res) {
                           const category = new Category({                                            -- "category" const variable with properties to accept...
                              new: req.body.name                                                      -- ... which in this case is "name" with the value from the req.body of the input.
                           });                                                                           *Additionally, you want to EXPLICITLY tell the server what params we want it to accept
                        });                                                                              from the client, because otherwise the client could send something else that would
                                                                                                         then be added to the category object.
                ---------------------------------------------------------------------------


        15.6: Then save the new category to the database:
                ---------------------------------------------------------------------------
                        // Create Category Route
                        router.post('/', function(req, res) {
                           const category = new Category({                                    
                              new: req.body.name                                         
                           });        
                           category.save(function (err, newCategory) {                                -- Call the save method on the category object with a callback...  
                              if (err) {                                                              -- if there is an error...
                                 res.render('categories/new', {                                       -- render the category/new page again and...
                                    category: category,                                               -- ... keep the string the user put in the input (to help them see the issue) and...
                                    errorMessage: 'Error creating category'                           -- ... return an error message.
                                 });                                                   
                              } else {                                                                -- "else" the post being successfully submitted...
                                 res.redirect('categories');                                          -- redirect back to the categories page. *Note that you can comment out 
                              }                                                                          res.redirect(`categories/${newCategory.id}`); and uncomment it when we hook this  
                           });                                                                           post request up to the database via mongoose. What this will do is redirect to     
                        });                                                                              the newly created category!
                --------------------------------------------------------------------------- 


// Create error message partial...
        ===================================================================================
        * When you created the "create category route", you 
        ===================================================================================

        15.7: Create a partial file for the error message:
                ---------------------------------------------------------------------------
                        views  >  partials  >  errorMessage.ejs
                --------------------------------------------------------------------------- 

        15.8: Create error message partial:
                ---------------------------------------------------------------------------              If the error message is NOT set, run the code errorMessage.
                        <% if (locals.errorMessage != null) { %>                                      -- Note here that you need to wrap error messages in if statements like this.
                           <%= errorMessage %>                                                           The ejs does not have an "=" so its just output to the server.
                        <% } %>
                ---------------------------------------------------------------------------  

        15.9: Include the errorMessage partial in layout.ejs:
                ---------------------------------------------------------------------------
                        <%- include('../partials/header.ejs') %>
                        <%= include('../partials/errorMessage.ejs') %>                                 -- include the errorMessage partial.
                        <%- body %>
                ---------------------------------------------------------------------------
               

// Add async to the "Create Category Route"...
        ===================================================================================
        * So with async, it really straight forward. Add the async prefix and then wrap the
          existing code in a try/catch block so that if there are any errors in our mongoose
          implementation, we'll be able to "catch" them
        ===================================================================================

        15.10: Add the "async" prefix and add try/catch block:
                ---------------------------------------------------------------------------
                router.post('/', async function(req, res) {                                              -- added async prefix.
                   const category = new Category({
                      name: req.body.name
                });
                try {                                                                                    -- try/catch block
                   // success code here...
                } catch(err) {
                   // error code here...
                }
               
                                
                });
                ---------------------------------------------------------------------------

        15.11: Add the error part of the existing code:
                ---------------------------------------------------------------------------
                router.post('/', async function(req, res) {
                   const category = new Category({
                      name: req.body.name
                   });
                   try {

                   } catch(err) {                                                                         -- catch for error
                      res.render('categories/new', {
                      category: category,
                      errorMessage: 'Error creating category'
                      });    
                   }
                });
                ---------------------------------------------------------------------------

        15.12: Add the success part of the code:
                ---------------------------------------------------------------------------
                router.post('/', async function(req, res) {
                   const category = new Category({
                      name: req.body.name
                   });
                   try {
                      const newCategory = await category.save()                                           -- awaits for category.save to finish then populate the "newCategory" variable
                      // res.redirect(`categories/${newCategory.id}`);
                      res.redirect(`categories`);
                   } catch(err) {
                      res.render('categories/new', {
                      category: category,
                      errorMessage: 'Error creating category'
                      });    
                   }
                });
                ---------------------------------------------------------------------------




Phase 16: Display All categories feature to app:
        ====================================================================================
        * In this phase, we'll display all the categories we have in our database in a single
          place so that the user can choose which one to find all the issues that pertain to it.
        ====================================================================================

// Add async to All Categories route...
        ====================================================================================
        * Simply create add a async prefix, add a try/catch block when interacing with mongoose, 
          await searching Category via find for all categories, and render categories to 
          categories/index. 
        ====================================================================================
        
        16.1: Add async to the "all categories" route:
                ------------------------------------------------------------------------------
                        // All Categories Route
                        router.get('/', async function(req, res) {                                       -- add async prefix
                           try {                                                                         -- add try block to execute any code is successful with mongoose. 

                           } catch(err) {                                                                -- add catch block if any errors with implementation with mongoose.

                           }


                           //res.render('categories/index');                                              -- comment out existing code (makes it easier to work on)
                        });
                ------------------------------------------------------------------------------


        16.2: Build the all categories route:
                * Remember that there is bunch of functionality that you can perform on the
                  models that you call. For example, we could "find" all the categories in the
                  database (here accomplished with by passing an empty object). If there where
                  conditions for the .find method, they would go in that currently empty object.
                ------------------------------------------------------------------------------
                        // All Categories Route
                        router.get('/', async function(req, res) {                            
                           try {                                                                 
                              const categories = await Category.find({})                                -- "categories" variable that awaits a function on the Category model that "finds" all categories.
                              res.render('categories/index', { categories: categories});                -- render categories.
                           } catch(err) {                                                    
                              res.redirect('/');                                                        -- if an error (i.e. database is inaccessible), redirect to main page.
                           }
                        });
                ------------------------------------------------------------------------------


// Create view for all categories...
        ======================================================================================
        * On this page, we want to have a search form at the top and a list of all the categories
          listed on the bottom.
        ======================================================================================
        
        16.3: Create view for see all categories in categories > index.js:
                ------------------------------------------------------------------------------
                <h2>Search Categories</h2>
                <form action="/categories" method="GET">                                                 -- Form with GET categories pointing to categories index page (remember GET... not POST).
                   <label>Name</label>
                   <input type="text" name="name">
                   <button type="submit">Search</button>
                </form>
                <br>
                <% categories.forEach( function(category) { %>                                           -- To display all the categories, loop through each item in categories and create a div with the name.
                   <div><%= category.name %></div>                                                          When you go to "Categories" page, you should see all the names you 
                <% }) %>
                ------------------------------------------------------------------------------


// Implement search feature for categories...
        =======================================================================================
        * To implement a search feature, you can add search options which will check to see if
          the name exists, if it is an empty string, and then using regular expressions, take 
          that query name and lowercase it to search the database. The solution to this involves
          a regular expression which im not too fantastic about but it seems to be the best way
          to implement the feature from research.
        =======================================================================================

        16.4: Add search features to all categories route:
                ------------------------------------------------------------------------------
                // All Categories Route
                router.get('/', async function(req, res) {
                   let searchOptions = {};                                                               -- "searchOptions" will store all the parameters for our search.
                   if (req.query.name !== null && req.query.name !== '') {                               -- if the request query (in the url) is not available AND not an empty string...
                      searchOptions.name = new RegExp(req.query.name, 'i');                              -- this will allow us to search for only part of the text in the field.
                   }
                   try { 
                      const categories = await Category.find({searchOptions})                            -- add "searchOptions" to find!
                      res.render('categories/index', { 
                        categories: categories, 
                        searchOptions: req.query                                                         -- and send back the request to the user so the field will be repopulated.
                      });  
                   } catch(err) {
                      res.redirect('/');
                   }
                });
                ------------------------------------------------------------------------------


// In index.js, add searchOptions as a value to the form...
        =======================================================================================
        * In the input form, add as a value the search options.
        =======================================================================================

        16.5: Add searchOptions as a value to the form:
                -------------------------------------------------------------------------------
                        <h2>Search Categories</h2>
                        <form action="/categories" method="GET">    
                        <label>Name</label>
                           <input type="text" name="name" value="<% searchOptions.name %>">              -- add searchOptions as the value.
                           <button type="submit">Search</button>
                        </form>
                        <br>
                        <% categories.forEach( function(category) {  %>
                           <div><%= category.name %></div>
                        <% }) %>
                -------------------------------------------------------------------------------





Phase 17: Add "issue" controller and view:
        ========================================================================================
        * Now that the category funcitonality has been sorted, we need to create the "issue"s
          that we can then file to the categories we have.
        ========================================================================================

// Create a "issues.js" router...
        =========================================================================================
        * Now because we've already done most of the work of creating a router file for 
          categories.js, we simply need to duplicate the categories.js, put it in issues.js, and 
          then clear out the logic inside the routes. The logic will be a bit more complex because
          we have a few more inputs and features to integrate.
        =========================================================================================
        
        17.1: Create issue.js router file:
                ---------------------------------------------------------------------------------
                        //Imports
                        const express = require('express');
                        const router = express.Router();
                        const { Issue } = require('../models/issue');                                     -- Import "Issue" model from models.


                        // Routes
                        // All Issues Route
                        router.get('/', async function(req, res) {
                        
                        });


                        //New Issue Route
                        router.get('/new', function(req, res) {
                        
                        });


                        // Create Issue Route
                        router.post('/', async function(req, res) {
                        
                        });
                ---------------------------------------------------------------------------------


// Create an "issue" model...
        =========================================================================================
        * We can do the same thing that we did for the issue,js router by copying the logic inside
          the category.js model file and pasting it into the issue model and amending it accordingly.
        =========================================================================================

        17.2:   Create issue model:
                ----------------------------------------------------------------------------------
                const mongoose = require('mongoose');

                const bookSchema = new mongoose.Schema({
                  title: {                                                                                 -- Title of issue (required)
                    type: String,
                    required: true,
                  },
                  problem: {                                                                               -- Problem that caused the issue (required)
                    type: String,
                    required: true
                  },
                  comments: {                                                                            -- extended description (if needed)
                    type: String,
                  },
                  solution: {                                                                               -- solution (when found)
                    type: String,
                  },
                  imageName: {                                                                              -- image of screencap of issue (if needed)
                    type: String,
                  },
                  createdAt: {                                                                              -- issue created (required)
                    type: Date,
                    require: true,
                    default: Date.now
                  },
                  category: {                                                                               -- Category type (required)
                    type: mongoose.Schema.Types.ObjectId,                                                    -- reference of the object id
                    required: true,
                    ref: 'Category'
                  }
                });

                const Book = mongoose.model('Book', bookSchema);

                module.exports = { Book };
                ----------------------------------------------------------------------------------

                ==================================================================================
                * Here's the basic format this model is going to accomplish:

                   Title:____________________________________________________________________
                   Created:_____________________________   Category:_________________________
                   Problem:__________________________________________________________________
                   Solution:_________________________________________________________________
                                 
                   Image-of-issue                      Comments:_____________________________                    

                ==================================================================================


// Add issue router to server.js...
        ===========================================================================================
        * Once you have the model done, you need to loaf the router into your server.js file and then
          tell the app to use the router.
        ===========================================================================================

        17.3: Add router and set:
                ------------------------------------------------------------------------------------
                        // Routers
                        const issueRouter = require('./routes/issues');                                     -- load router to server.js

                        // Middleware
                        app.use('/issue', issueRouter);                                                     -- tell app that all issue routes will go to issueRouter
                ------------------------------------------------------------------------------------


// Add issue links to header.js...
        ============================================================================================
        * Because the we already have a view for the navigation created (i.e. header.js), we simply
          need to add the links to this partial file. Since this is basically a duplicate process 
          compared ot the categories process, all you need to do is copy and paster the two existing
          links for all categories and new categories and change the url and names.
        ============================================================================================

        17.4: Add issue links to header.js:
                ------------------------------------------------------------------------------------
                <header>
                  <nav>
                  <a href="/">IssueIndex</a>
                  <ul>
                     <li><a href="/categories">Categories</a></li>
                     <li><a href="/categories/new">Add Category</a></li>
                     <li><a href="/issues">Issues</a></li>                                                  -- Link to all issues
                     <li><a href="/issues/new">Add Issue</a></li>                                           -- LInk to add issue
                  </ul>
                  </nav>
                </header>
                ------------------------------------------------------------------------------------



// Test issue route...
        ============================================================================================
        * In issue.js, test the all issues route by sending a basic response (res.send)
        ============================================================================================

        17.4: Insert test routes for issue.js:
                ------------------------------------------------------------------------------------
                        // Routes
                        // All Issues Route
                        router.get('/', async function(req, res) {
                           res.send('All issues works!');                                                    -- at localhost:3000/issues you will see the message
                        });


                        //New Issue Route
                        router.get('/new', function(req, res) {
                           res.send('New issues works!');                                                    -- at localhost:3000/issues/new you will see the message
                        });


                        // Create Issue Route
                        router.post('/', async function(req, res) {
                           res.send('Create issues works!');                                                
                        });
                ------------------------------------------------------------------------------------




Phase 18: Add "new issues" to views
        =============================================================================================
        * Roughly the same thing we did with adding new categories, so you can copy and paste the 
          entire file, rename it, and adjust accordingly
        =============================================================================================

// Create an "issues" file...
        ==============================================================================================
        * Create a new folder inside views for the issue views.
        ==============================================================================================

        18.1: Create issue file:
                --------------------------------------------------------------------------------------
                        views  >  issues
                --------------------------------------------------------------------------------------

 // Create a "new.ejs" file for new issues...
        =============================================================================================
        * Again, roughly the same thing done for the new.ejs file for category.
        =============================================================================================

        18.2: Create new.ejs file for new issue:
                -------------------------------------------------------------------------------------
                     <h2>New Issue</h2>
                     <form action="/issues" method="POST">
                       <%- include('_form_fields') %>
                       <a href="/issues">Cancel</a>
                       <button type="submit">Create</button>
                     </form>
                -------------------------------------------------------------------------------------

// Add form field partial for issue _form_fields.ejs...
        =============================================================================================
        * Again, same thing as done for categories. Copy and paste the _form_fields.ejs partial and 
          paste it in the issues folder, change the names and values to suit. However, this form
          will be substantially larger because we have a few more areas we want to include. In the case
          of this form partial, we want to be able to selct a category from our exiting list. To do this, 
          we nee dot loop through the categories and select the one that fits the best.
        =============================================================================================

        18.3: Add field form partial with all the forms you need:
                --------------------------------------------------------------------------------------
                        <label>Name</label>
                        <input type="text" name="title" value="<%= issue.title %>">                       -- remember to change the name (title) and value (issue.title).
                        
                        <label>Name</label>
                        <input type="text" name="title" value="<%= issue.title %>">     
                        <label>Category</label>
                        <select name="category">
                        <% categories.forEach( function(category) { %>
                        <% if (issue.id == issue.category) { %>
                        <option selected label="<%= category.name %>" value="<%= category.id %>">
                        <%= category.name %>
                        </option>
                        <% } else { %>
                        <option label="<%= category.name %>" value="<%= category.id %>">
                        <%= category. name %>
                        </option>
                        <% } %>
                        <% }) %>
                        </select>
                
                --------------------------------------------------------------------------------------

// In issues router, add new issue route...
        =============================================================================================
        * Now we can hook everything up. This really is all just about the same as what what done for
          categories, its just creating a new layer of search and create, etc.
        =============================================================================================

        18.4: Import Category router:
                ------------------------------------------------------------------------------------
                        const { Category } = require('../models/category');
                ------------------------------------------------------------------------------------


        18.5: Add new issue route:
                -------------------------------------------------------------------------------------
                //New Issue Route
                router.get('/new', async function(req, res) {
                  try {
                    const categories = await Category.find({});                                       -- get all categories, categories equal to await (i.e. wait until) Category model and find everything (i.e. {})
                    const issue = new Issue();                                                        -- create a new Issue
                    res.render('issues/new', {                                                        -- if successful, render issues/new and pass in variables
                      categories: categories,                                                         -- send categories to new page and...
                      issue: issue                                                                    -- send issues to the new page.
                    })                      
                    } catch (err) {
                       res.redirect('/issues');                                                       -- if the are any errors, redirect back to the /issues page.
                    }
  
                -------------------------------------------------------------------------------------


// Complete form field partial for add issue...
        ============================================================================================
        * To finish off the form field partial for adding issues, just add the remaining fields that
          you specified in your models file.
        ============================================================================================

        18.6: Complete form partial for add issue:
                ------------------------------------------------------------------------------------
                <div>
                <label>Name</label>                                                                    -- Name of the issue.
                <input type="text" name="title" value="<%= issue.title %>">    
                </div>

                <div>
                <label>Category</label>                                                                -- Category selector
                <select name="category">
                <% categories.forEach( function(category) { %>
                <% if (issue.id == issue.category) { %>
                <option selected label="<%= category.name %>" value="<%= category.id %>">
                <%= category.name %>
                </option>
                <% } else { %>
                <option label="<%= category.name %>" value="<%= category.id %>">
                <%= category. name %>
                </option>
                <% } %>
                <% }) %>
                </select> 
                </div>

                <div>
                <label>Description</label>                                                              -- Issue description
                <textarea name="description" value="<%= issue.description %>"></textarea>    
                </div>

                <div>
                <label>Solution</label>                                                                 -- Issue solution
                <textarea name="solution" value="<%= issue.solution %>"></textarea>    
                </div>

                <div>
                <label>Image</label>                                                                    -- image of issue if applicable.
                <input type="file" name="image">    
                </div>

                ------------------------------------------------------------------------------------


// Hookup issue form to route...
        =============================================================================================
        * Once you have the form fields all set (and make sure you have a definite plan with the model),
          create the initial route for each of the input fields from the form fields.
        =============================================================================================

        18.7: Create issue route:
                ------------------------------------------------------------------------------------
                        // Create Issue Route
                        router.post('/', async function(req, res) {                                       -- make sure it is an async function
                          const issue = new Issue({                                                       -- create issue object with...
                            title: req.body.title,                                                        -- title set to the input of title in the form
                            category: req.body.category,                                                  -- category set to the selection of category
                            description: req.body.description,                                            -- description set to the input of description in the form
                            solution: req.body.solution                                                   -- solution set to the input of solution in the form
                          });
                        });
                ------------------------------------------------------------------------------------




Phase 19: Setup file uploading
        ==============================================================================================
        * File uploading will allow us to upload a picture of the issue to the app. To do this, we'll
          use a library called "multer" which will allow you to work with multi-part forms, which is 
          what a file form is.
        ==============================================================================================

// Install multer...
        19.1: Install multer via npm:
                -------------------------------------------------------------------------------------
                        npm install multer
                -------------------------------------------------------------------------------------

// Add enctype to "add issue" form...
        19.2: In "issues" > "new.ejs", add enctype to take multipart form type:
                ---------------------------------------------------------------------------
                <h2>Add Issue</h2>
                <form action="/issues" method="POST" enctype="multipart/form-data">              --tells the server that the form is going to send multipart form data which could include a file.
                <%- include('_form_fields') %>
                <a href="/issues">Cancel</a>
                <button type="submit">Create</button>
                </form>
                -----------------------------------------------------------------------------

// Import multer to issues.js...
        19.3: Require multer in issues.js:
                ------------------------------------------------------------------------------------
                        const multer = require('multer');
                ------------------------------------------------------------------------------------

// Configure upload to use multer:
        19.4: Create an upload variable equal to the setup for multer:
                ------------------------------------------------------------------------------------
                        const upload = multer({                                                           -- this is going to help configure multer to use with this application.
 
                        });
                ------------------------------------------------------------------------------------

// Create a basepath for uploaded images in issue.js model file...
        ============================================================================================
        * This is going to be where the static images for issue screencaps will go to. In this case, 
          we'll want to store them in the public folder.
        ============================================================================================

        19.5: Create a basepath for upload images:
                -----------------------------------------------------------------------------------
                        const imageBasePath = 'uploads/images'                                         -- Path to where the images will be stored
                -----------------------------------------------------------------------------------

        19.6: Export the imageBasePath variable:
                -----------------------------------------------------------------------------------
                        module.exports.imageBasePath = imageBasePath;                                  -- Export the variable.
                -----------------------------------------------------------------------------------

        19.7: Import the "path" library:
                ----------------------------------------------------------------------------------- 
                        const path = require('path');                                                   -- built-in library
                ----------------------------------------------------------------------------------- 

        19.8: Create an upload path:
                -----------------------------------------------------------------------------------
                        const uploadPath = path.join('public', )                                        -- upload path joins public folder and Issue variable plus the imageBasePath we imported.
                -----------------------------------------------------------------------------------

        19.9: In the upload variable, we can set the destination to the uploadPath:
                -----------------------------------------------------------------------------------
                        const upload = multer({
                          dest: uploadPath,                                                             -- destinaton set to the upload path (i.e. public/Issue.imageBasePath), which is in the public folder
                          fileFilter: function (req, file, callback) {                                  -- filter files the server will accept, which takes the request, the file itself, and the callback when we're done.
                          callback(null)
                        }
                -----------------------------------------------------------------------------------

        19.10: Specifiy the types of files you want to have uploaded:
                -----------------------------------------------------------------------------------
                        const imageMimeTypes = ['image/jpeg', 'image/png', 'image/gif']               -- array with the default file types we will allow to be uploaded.
                -----------------------------------------------------------------------------------

        19.11: Then add this to the upload variable:
                -----------------------------------------------------------------------------------
                        const upload = multer({
                          dest: uploadPath,  
                          fileFilter: function (req, file, callback) {     
                          callback(null, imageMimeTypes.includes(file.mimetype));                      -- mimetype added.
                          }
                        });
                -----------------------------------------------------------------------------------


// Setup route to accept files...
        ============================================================================================
        * Now that you have specified where you want your images to go, you need to setup the route
          that will allow you to upload the images.
        ============================================================================================

        19.12: Add a parameter to the "Create Issue Route" post route.
                *  This parameter takes the "upload" variable, tell it we have a single variable being uploaded with the file name.
                *  Adidtional, add a filename variable.                 
                ------------------------------------------------------------------------------------
                     router.post('/', upload.single('image'), async function(req, res) {                -- this parameter tells multer that we are upload ing a single file called "image"
                        const fileName = req.file != null ? req.file.filename : null;                   -- get the file from the filename       
                        const issue = new Issue({
                        title: req.body.title,
                        category: req.body.category,
                        description: req.body.description,
                        solution: req.body.solution,
                        imageName: fileName                                                             -- if a file is uploaded, which will be equal to the name of the file (see fileName)
                        });
                     });
               ------------------------------------------------------------------------------------

        19.13: Add in the try/catch block:
                -----------------------------------------------------------------------------------
                        router.post('/', upload.single('image'), async function(req, res) {    
                          const fileName = req.file != null ? req.file.filename : null;  
                          const issue = new Issue({
                            title: req.body.title,
                            category: req.body.category,
                            description: req.body.description,
                            solution: req.body.solution,
                            imageName: fileName
                          });
                          try {                                                                       -- try block that saves issue to database and then redirects (for now) to issues page.
                            const newIssue = await issue.save();
                            // res.redirect('issues/${newIssue.id}');
                            res.redirect('issues');
                          } catch(err) {                                                              -- catch block will render new page, however at this point we already have the work done.
                                                                                                         To cut down on repetitive code, create a function with the preexisting code in new issue route. 
                          }
                        });
                -----------------------------------------------------------------------------------

        19.14: Create a "renderNewPage" from "create issue route":
                * This code will be repeatable so we'll just take it out and make it reusable.
                -----------------------------------------------------------------------------------
                        async function renderNewPage(res, issue, hasError = false) {                  -- the asynchronous renderNewPage will use the res variable to render and redirect, the issue variable for rendering new or existing book, and hasError message.
                          try {                                                                       -- existing route logic from new issue route.
                            const categories = await Category.find({});                               -- ... which selects categories
                            const params = {                                                          -- relocate parameters in existing render to params variable and pass this new variable to where we had it before.
                            categories: categories,
                            issue: issue
                          }
                          if (hasError) {
                            params.errorMessage = 'Error Creating Issue'
                          }
                          // const issue = new Issue();                                              -- removed create new issue.
                          res.render('issues/new', params);                                          -- relocated params
                          } catch (err) {
                            res.redirect('/issues');  
                          }
                        }
                -----------------------------------------------------------------------------------

        19.15: Call "renderNewPage" where you need to (i.e. create new issue):
                -----------------------------------------------------------------------------------
                        //New Issue Route
                        router.get('/new', async function(req, res) {
                          renderNewPage(res, new Issue());
                        });
                -----------------------------------------------------------------------------------

                And in the error message for our post:
                -----------------------------------------------------------------------------------
                        router.post('/', upload.single('image'), async function(req, res) {    
                          const fileName = req.file != null ? req.file.filename : null;  
                          const issue = new Issue({
                            title: req.body.title,
                            category: req.body.category,
                            description: req.body.description,
                            solution: req.body.solution,
                            imageName: fileName
                          });
                          try {  
                            const newIssue = await issue.save();
                            // res.redirect('issues/${newIssue.id}');
                            res.redirect('issues');
                          } catch(err) {  
                            renderNewPage(res, issue, true);                                          -- renderNewPage called with res, the issue object, and true because it has an error.
                          }
                        });           
                -----------------------------------------------------------------------------------

// Test add issue...
        ===========================================================================================
        * Test to see if the basic route works. If you put in all the relavant information and upload
          the image, you will see that your public folder has the image and a new document with your
          test information. Also, test leaving a blank input field for a required section and see if 
          the error text appears above the add issue field.
        ===========================================================================================


// Add logic to remove issue images that are not in the database...
        ============================================================================================
        * Suppose you delete an issue for some reason and that issue had a image attached to it. If 
          you dont add this logic, tyour public folder will keep the redundant image. To to this you 
          need to install another library called "file system", or "fs" for short. This is also a built
          in library in node so you dont need to install via npm.
        ============================================================================================

        19.16: Load file system library:
                -----------------------------------------------------------------------------------
                        const fs = require('fs');                                                       -- built in library for file system in node.
                -----------------------------------------------------------------------------------

        19.17: Add a "removeImage" function to create issue route:
                -----------------------------------------------------------------------------------
                ...
                ...
                } catch(err) {
                  if (issue.imageName != null) {
                    removeImage(issue.imageName)                                                        -- removeImage with filename passed in if error occurs
                  } 
                  renderNewPage(res, issue, true); 
                  }
                });
                -----------------------------------------------------------------------------------

        19.18: Create removeImage function:
                -----------------------------------------------------------------------------------
                // Remove Image if error
                function removeImage(fileName) {
                  fs.unlink(path.join(uploadPath, fileName), function(err) {                            -- tells the file system to remove the file that you dont want anymore and pass the pass where the file is at.
                    if (err) {                                                                          -- and if there is an error...
                    console.err(err)                                                                    -- log the error to the console.
                    }
                  });
                }
                -----------------------------------------------------------------------------------





Phase 20: Setup "All Issues" page:
        ============================================================================================
        * The all issues page is going to be a long list of all the issues that are saved to the 
          database.
        ============================================================================================

// Copy the same code from the Category index.js file.
        ============================================================================================
        * Although you could do this from scratch, the code is essentially the same as what you will
          find in the index.js for categories, you just need to change the titles, etc.
        ============================================================================================

        20.1: Create an index file:
                ------------------------------------------------------------------------------------
                        views  >  issues  >  index.ejs                                                  -- note to self, remember ejs not js lol.
                ------------------------------------------------------------------------------------

        20.2: Copy and paste index.js code from categories and change labels:
                ------------------------------------------------------------------------------------
                        <h2>Search Issues</h2>                                                          -- change category to issues
                        <form action="/issues" method="GET">                                            -- change action from /categories to /issues route
                          <div>
                          <label>Title</label>                                                          -- add Title
                          <input type="text" name="title" value="<% searchOptions.title %>">            -- change to title for search options and name.
                          </div>
                          <button type="submit">Search</button>
                        </form>
                        <br>
                        <div>
                          <% issues.forEach( function(issue) {  %>                                      -- issues replaces categories3533image
                          <div><%= issue.title %></div>
                          <% }) %>
                        </div>
                ------------------------------------------------------------------------------------

// Implement logic for issues route...
        20.3: Implement page on the issues.js server:
                ------------------------------------------------------------------------------------
                        // All Issues Route
                        router.get('/', async function(req, res) {
                          try {
                            const issues = await Issue.find({})
                            res.render('issues/index', {                                                -- render page issues/index and pass...
                            issues: issues,                                                             -- ... the issues
                            searchOptions: req.query                                                    --  and search params
                          });
                        } catch(err) {
                          res.redirect('/');                                                            -- if error, redirect to main page.
                          }
                        });
                ------------------------------------------------------------------------------------

// Add search to issues
        20.4: Add search functionality to issues:
                ------------------------------------------------------------------------------------
                // All Categories Route
                        router.get('/', async function(req, res) {
                          let searchOptions = {}                                                       -- same logic from categories
                          if (req.query.name != null && req.query.name !== '') {
                            searchOptions.name = new RegExp(req.query.name, 'i')
                          }
                          try {
                            const categories = await Category.find(searchOptions);
                            res.render('categories/index', { 
                              categories: categories,
                              searchOptions: req.query
                            });
                        } catch(err) {
                           res.redirect('/');
                          }
                        });
                ------------------------------------------------------------------------------------





Phase 21: Build out initial code for main page:
        ===========================================================================================
        * 
        ===========================================================================================

// Add initial code and "recents" logic...
        21.1: Added logic to print recent issues to the home page:
                ---------------------------------------------------------------------------------------------
                        <h2>Recent Issues</h2>
                        <div>
                        <% issues.forEach( function(issue) {  %>
                        <div><%= issue.title %></div>
                        <% }) %>
                        </div>
                ---------------------------------------------------------------------------------------------

// Add issues to main index.js...
       21.2: In the routes > index.js, pass the issue variable:
                ---------------------------------------------------------------------------------------------
                        // root index route
                        router.get('/', function(req, res) {
                          res.render('index', { issues: issues });
                        });
                ---------------------------------------------------------------------------------------------

// Add logic to sort most recent logic...
        21.3: load the books model:
                ---------------------------------------------------------------------------------------------
                        const Issue = require('../models/issue');
                ---------------------------------------------------------------------------------------------

// Add logic to index.ejs:
        21.4: Add most recents:
                --------------------------------------------------------------------------------------------
                        // root index route
                        router.get('/', async function(req, res) {
                          let issues;
                          try {
                            issues = await Issue.find().sort( { createdAt: 'desc' }).limit(10).exec();        -- This will find all the issues in the database and sort them. exec is used to execute the code.
                          } catch(err) {
                            issues = [];
                          } 
                           res.render('index', { issues: issues });
                        });
                --------------------------------------------------------------------------------------------



Phase 22: Enable file upload to database.
        ===================================================================================================
        * For the image upload feature that will allow the user to upload images of the issue, the app will
          use a library called filepond. It makes uploading much easier inside the app and has a really neat 
          looking drag-and-drop feature.   
        * https://pqina.nl/filepond/
        * https://pqina.nl/filepond/docs/patterns/plugins/file-encode/
        ===================================================================================================

// Setup filepond...
        ==================================================================================================
        * We'll want to use this library on every single page we have in the application.
          REMEMBER: Library goes AFTER ALL plugins.
          ALSO REMEMBER: DEFER scripts.
          ALSO REMEMBER: Links first, scripts second, library last.
        ==================================================================================================

        22.1: Add filepond to layout.js
                ------------------------------------------------------------------------------------------------------------------------
                        <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">                                               -- filepond styelsheet 
                        <link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet">     -- filepond upload stylesheet
                        <script defer src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>       -- filepond upload js
                        <script defer src="https://unpkg.com/filepond-plugin-file-encode/dist/filepond-plugin-file-encode.js"></script>           -- filepond file encode plugin js
                        <script defer src="https://unpkg.com/filepond-plugin-image-resize/dist/filepond-plugin-image-resize.js"></script>         -- filepond image resize
                        <script defer src="https://unpkg.com/filepond/dist/filepond.js"></script>                                                 -- filepond library
                        <script defer src="/javascripts/fileUpload.js"></script>                                                                  -- script we create to setup filepond library                                                            
                ------------------------------------------------------------------------------------------------------------------------

        22.2: Create a folder called javascripts:
                -----------------------------------------------------------------------------------------
                        public  >  javascripts
                -----------------------------------------------------------------------------------------

        22.3: Insice javascripts, add a file called fileUpload.js:
                ----------------------------------------------------------------------------------------
                        public  >  javascripts  >  fileUpload.js
                ----------------------------------------------------------------------------------------
                
        22.4: In the documentation for filepond, 
                ----------------------------------------------------------------------------------------
                       FilePond.parse(document.body);                                                      -- turns all fileinputs into filepond inputs
                ----------------------------------------------------------------------------------------

        22.5: Add the registerPlugin method to list all the plugins to be installed in fileUpload.js:
                ----------------------------------------------------------------------------------------
                        FilePond.registerPlugin(
                          FilePondPluginImagePreview,
                          FilePondPluginImageResize,
                          FilePondPluginFileEncode,
                        );
                ----------------------------------------------------------------------------------------

        22.6: In views > issues > _form_fields.ejs, for the cover image loader, add "filepond" class:
                ----------------------------------------------------------------------------------------
                        <div>
                           <label>Image</label>
                           <input type="file" name="image" class="filepond">                                 -- added filepond class
                        </div>
                ----------------------------------------------------------------------------------------

// Modify style to fit upload image...
        =========================================================================================
        * IN the documentation, go to filepond instance and scroll down to "styles" to find the
          correct instance to change the apsect ratio (i.e. stylePanelAspectRatio).
        =========================================================================================

        22.7: Find the style instance you want:
                -------------------------------------------------------------------------------
                        stylePanelAspectRatio
                -------------------------------------------------------------------------------

        22.8: Add a setOptions method and add the aspect ratio instance:
                * This is important because when you post the file to ther server it will not be larger
                  than 100 px wide or tall.
                -------------------------------------------------------------------------------
                        FilePond.registerPlugin(
                          FilePondPluginImagePreview,
                          FilePondPluginImageResize,
                          FilePondPluginFileEncode,
                        );

                        FilePond.setOptions({                                                      -- set the option to style the aspect ratio to 100/100
                                stylePanelAspectRatio: 100/100,                                           -- size of the panel
                                imageResizeTargetWidth: 100,                                              -- width
                                imageResizeTargetHeight: 100,                                             -- height
                        }); 
                        })

                        FilePond.parse(document.body);
                -------------------------------------------------------------------------------


// Add code to route to parse the file...
        =========================================================================================
        * The first thing to figure out is how the file is getting sent to the server. It is NOT
        getting sent as a file object. In fact, in the documentation for "file encode", it uses a 
        JSON string to send to the server. You will notice that if you look at the resulting object
        it, it uses a "data" property, which is a string representation of the image file we're 
        uploading from the file to the server. Because this is the case, you dont have to use a multi
        part form anymore so it can be removed from the new issue form
        =========================================================================================

// Remove multer and multi-part form code...
        ==========================================================================================
        * Since we're now uploading a single string instead of a multi-part form, you can remove 
          the enctype and 
        ==========================================================================================

        22.9: Remove enctype from issue > new.ejs:
                ----------------------------------------------------------------------------------
                        enctype="multipart/form-data"                                                   -- this is removed
                ----------------------------------------------------------------------------------

        22.10: Remove upload (because we're getting a string, not a file)  
                ----------------------------------------------------------------------------------
                        router.post('/', upload.single('image'), async function(req, res) { ...          -- before
                        router.post('/', async function(req, res) { ...                                  -- after
                ----------------------------------------------------------------------------------

        22.11: Remove multer from issues.js:
                ----------------------------------------------------------------------------------
                        const multer = require('multer');                                              -- removed
                ----------------------------------------------------------------------------------

        22.12: Comment out code being used by multer:
                ----------------------------------------------------------------------------------
                        // const imageMimeTypes = ['image/jpeg', 'image/png', 'image/gif']; 
                        // const upload = multer({
                        //   dest: uploadPath,  
                        //   fileFilter: function (req, file, callback) {     
                        //     callback(null, imageMimeTypes.includes(file.mimetype));
                        //   }
                        // });
                ----------------------------------------------------------------------------------

        22.13: Remove multer via npm:
                -----------------------------------------------------------------------------------
                        npm uninstall multer
                -----------------------------------------------------------------------------------
                

// To save files (without multer), modify issues object...
        ===========================================================================================
        * Now with multer gone we need to save files a different way. First, you need to alter
          the issue model.
        ===========================================================================================

        22.14: Make alterations to the issue model:
                -----------------------------------------------------------------------------------
                        image: {                                                                     -- removed name from property.
                          type: Buffer,                                                              -- changed from String to Buffer of the image representing the image.
                        },
                        imageType: {                                                                 -- imageType added to know what type of image it is (jpeg, png, etc).
                          type: String,
                        }
                -----------------------------------------------------------------------------------

// In the route, add code to upload the issue file...
        22.15: Add saveImage to add issue route:
                ----------------------------------------------------------------------------------
                        // Create Issue Route
                           router.post('/', async function(req, res) {    
                                const fileName = req.file != null ? req.file.filename : null;  
                                const issue = new Issue({
                                  title: req.body.title,
                                  category: req.body.category,
                                  description: req.body.description,
                                  solution: req.body.solution,
                                  imageName: fileName
                                });
                                saveImage(issue, req.body.image);                                     -- save the image as well as the encoded json image in req.body.image
                                try { 
                                  const newIssue = await issue.save();
                                  // res.redirect('issues/${newIssue.id}');
                                  res.redirect('issues');
                                } catch(err) {
                                  if (issue.imageName != null) {
                                  removeImage(issue.imageName) 
                                } 
                                renderNewPage(res, issue, true); 
                                }
                           });
                ----------------------------------------------------------------------------------

// Create the saveImage function...
        22.16: Create saveImage function:
                ----------------------------------------------------------------------------------
                        function saveImage(issue, imageEncoded) {                                    -- check to see if the image is a valid image and if it is, save it to issue.image.
                          if(imageEncoded == null)  {
                            return 
                          }
                          const image = JSON.parse(imageEncoded);                                    -- next, parse the string (becuase imageEncoded is justa string thats actually JSON) into a JSON object called image.                      
                          if (image != null && imageMimeTypes.includes(image.type)) {                -- then check to see if the image is not null and is of the correct type AND of the correct type (uncomment mimetypes var). You also want to chnage file to image and mimetype to type to check the image type.
                            issue.image = new Buffer.from(image.data, 'base64')                      -- if it isnt equal to null and it is a valid type, then we can save the properties to the issue but convert to a buffer and specify that it is also base64 encoded. 
                            issue.imageType = image.type                                             -- This will allow us to extract out the buffer and convert it back into an image of the correct type.
                          }                  
                        }

                ----------------------------------------------------------------------------------

// Remove removeImage since we are not storing images on server.
        22.17: Remove "removeImage" function:
                ----------------------------------------------------------------------------------
                        // Remove Image if error (removed bc images not stored locally anymore)
                        function removeImage(fileName) {
                        fs.unlink(path.join(uploadPath, fileName), function(err) {       
                        if (err) {    
                        console.err(err)   
                        }
                        });
                        }
                ----------------------------------------------------------------------------------

// Remove code from catch
        22.18: remove catch logic
                ----------------------------------------------------------------------------------
                        } catch(err) {
                                                                if (issue.imageName != null) {       -- remove this.
                                                                removeImage(issue.imageName) 
                                                                } 
                        renderNewPage(res, issue, true); 
                        }
                ----------------------------------------------------------------------------------

// Remove imagename and filename variable from create issue route:
        22.19: Remove imagename
                ----------------------------------------------------------------------------------
                        const fileName = req.file != null ? req.file.filename : null;                 -- remove
                        ...
                        imageName: fileName                                                           -- remove
                ----------------------------------------------------------------------------------

// Test...
        22.20: Test by creating a new issue and see if the
        * Note: for images c41513 if you wish to display them on the issues page, you will need to
          adjust the issue.virtual

// Remove existing elements that are needed anymore...
        * delete uploads folder.
        * remove uploadPath in issue.js.
        * delete 
                const path = require('path'); 
                const imageBasePath = 'uploads/images'; 
                module.exports.imageBasePath = imageBasePath; 
          in the issue.js model.
        * remove multer code in issue.js
        * remove path and filesystme in issue.js

// Potential fix from no-image save:
         add an or that specifies that it is either just the issue OR issue and the image:   saveImage(issue || issue, req.body.image);  
         if there are any problems, come back to this point.




Phase 23: Create show, edit, update, and delete routes for categories.
=======================================================================

23.1: Create route for showing categories page
        ----------------------------------------------------------------------------------
        // Show categories
        router.get('/:id', function (req, res) {        // get route for categories, pass in "/:id" which means that an id is going to be passed along with the request.
        res.send('Show Category ' + res.params.id)     // this req.params.id on the request object will get all the parameters we defined inside the url
        })                 

        ----------------------------------------------------------------------------------

23.2: create route for edit page:
        ---------------------------------------------------------------------------------
        // Edit categories page
        router.get('/:id/edit', function (req, res) {           // use id again because we need it to select what we want to edit.
        res.send('Edit Category ' + res.params.id)           // this req.params.id on the request object will get all the parameters we defined inside the url
        });
        ---------------------------------------------------------------------------------

23.3: Create a route for the 
        ---------------------------------------------------------------------------------
        // Update route page
        router.put('/:id', function(req, res) {                  // put is saying this is going to be edited so no need for edit.
        res.send('Update Categoruy ' + res.params.id)           // this req.params.id on the request object will get all the parameters we defined inside the url
        });
        ---------------------------------------------------------------------------------

23.4: Create delete category route:
        -----------------------------------------------------------------------------------
        // Delete categories route
        router.delete(':/:id', function(req, res) {
        res.send('Delete Categoruy ' + res.params.id)           // this req.params.id on the request object will get all the parameters we defined inside the url
        });
        -----------------------------------------------------------------------------------


Phase 24: Install "method override" library that allows put and delete requests:
================================================================================
        * Methods-override will let you take a post form, send it to the server
        with a special parameter that tells us if we are doing a put or a delete
        request and the server will be smart enough to call the correct router for
        delete or put based on a specific parameter. 
================================================================================

24.1: Install methodoveride library via npm:
        ----------------------------------------------------------------------------
        npm method-override
        ----------------------------------------------------------------------------

24.2: IN server.js, include method-override:
        ----------------------------------------------------------------------------
        const methodOverride = require('method-override');
        ----------------------------------------------------------------------------

24.3: Tell the app to use method-override:
        ----------------------------------------------------------------------------
        app.use(methodOverride('_method'));                                                 // here you pass in methodOverride and tell it what that parameter to be.
        ----------------------------------------------------------------------------

24.4: In search categories, add "view" and "edit" category anchor tag feature (this is where you can edit, delete, etc):
        ----------------------------------------------------------------------------
        <h2>Search Categories</h2>
        <form action="/categories" method="GET">    
        <label>Name</label>
        <input type="text" name="name" value="<% searchOptions.name %>">
        <button type="submit">Search</button>
        </form>
        <br>

        <% categories.forEach( function(category) {  %>
        <div><%= category.name %></div>                                                   
        <a href="/categories/<%= category.id %>">View</a>                               // add an anchor tag with a link to the category id.
        <% }) %>

        ----------------------------------------------------------------------------

24.5: Test view and edit links:
        ------------------------------------------------------------------------------
        Show Category 5e138a3fef511b3838890651
        //
        Edit Category 5e138a3fef511b3838890651
        ------------------------------------------------------------------------------

24.6: Add a form for the delete route:
======================================================================================
* Note: You NEVER want to use a get route for any delete function because when a search
  engine like google come around in order to index it on the search pages they will go
  to every get route on your website. So when google comes around to every link at this 
  point and if google sees an a-tag and clicks on every single one of them and delete
  very single thing in your application. To avoid this, we need to use a form instead
  of a GET request.
======================================================================================
        ------------------------------------------------------------------------------- 
        <form method="POST" action="/categories/<%= category.id %>?_method=DELETE">            // POST method is overridden by the _method, and the action is the url, question mark with a query parameter set to DELETE.
            <button type="submit">Delete</button>                                               // and add delete button that will work like the anchor tags above.
        </form>
        -------------------------------------------------------------------------------

24.7: Break the delete form out to a partial:
======================================================================================
* Since the application needs to have the delete functionality over more than just this
  one part, it would be best at this point to make this into a partial so that we can
  use a single file for multiple uses.

======================================================================================
        
        1. Create a new partial file called "deleteForm.ejs"
        --------------------------------------------------------------------------------
                deleteForm.ejs
        --------------------------------------------------------------------------------

        2. Place the delete form inside this partial file:
        --------------------------------------------------------------------------------
        <form method="POST" action="/categories/<%= category.id %>?_method=DELETE">
        <button type="submit">Delete</button>
        </form>
        --------------------------------------------------------------------------------

        3. Change the url (since it will be different every time we use it)
        --------------------------------------------------------------------------------
        <form method="POST" action="<%= url =%>?_method=DELETE">                            // pass in dynamic url
        <button type="submit">Delete</button>
        </form>
        --------------------------------------------------------------------------------

        4. In the index.ejs for categories, include the partial:
        =================================================================================
           use syntax with hyphen, use include, go back one directory and go to 
           partials/deleteForm. Then, pass in the url to the section we removed before we 
           created the partial.
        =================================================================================
        ---------------------------------------------------------------------------------
        <% categories.forEach( function(category) {  %>
        <div><%= category.name %></div>
        <a href="/categories/<%= category.id %>">View</a>
        <a href="/categories/<%= category.id %>/edit">Edit</a>
        <%- include('../partials/deleteForm', { url: "/categories/<%= category.id %> })  %>        // include the deleteForm partial and pass in the url
        <form method="POST" action="/categories/<%= category.id %>?_method=DELETE">
        <button type="submit">Delete</button>
        </form>
        <% }) %>

        ---------------------------------------------------------------------------------

        5. Because this is within the server, you need to use backticks and string interpolation
        =================================================================================
         However, we need to use string interpolation because it is inside the server so 
         replace the ejs brackets with ticks and string interpolation.
        =================================================================================
        -----------------------------------------------------------------------------------
          <%- include('../partials/deleteForm', { url: `/categories/${category.id}` })  %>     
        -----------------------------------------------------------------------------------

        6. Lastly, remove the old form
        -----------------------------------------------------------------------------------
        <% categories.forEach( function(category) {  %>
        <div><%= category.name %></div>
        <a href="/categories/<%= category.id %>">View</a>
        <a href="/categories/<%= category.id %>/edit">Edit</a>
        <%- include('../partials/deleteForm', { url: `/categories/${category.id}` })  %>       
        <% }) %>
        -----------------------------------------------------------------------------------


Phase 25: Create Edit page
============================================================================================
* With the basic links working and the delete form sorted, first do the Edit button which is
  the easiest to do at this point.
============================================================================================

25.1: In categories.js, copy and paste the edit route into the /:id/edit route.
        -----------------------------------------------------------------------------------
        //New Category Route
        router.get('/new', function(req, res) {
          res.render('categories/new', { category: new Category() });                             << take this...
        });
                -==-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
        // Edit categories route
        router.get('/:id/edit', function (req, res) {     
          // res.send('Edit Category ' + req.params.id)                                          // remove this test code is you want (or comment it out)
          res.render('categories/new', { category: new Category() });                            << paste here
        });
        -----------------------------------------------------------------------------------

25.2: First, chnage the url to "edit" from "new":
        -----------------------------------------------------------------------------------
        // Edit categories route
        router.get('/:id/edit', function (req, res) {       
          res.render('categories/edit, { category: category });                            << change new to edit 
        });
        -----------------------------------------------------------------------------------

25.3: Second, add async functionality with a try/catch block since we want to get the categories from the database.
        -----------------------------------------------------------------------------------
        // Edit categories route
        router.get('/:id/edit', async function (req, res) {     
          try {
            const category = await Category.findById(req.params.id);                        // in the database, await when finding category by id.      
            res.render('categories/edit', { category: categort });                          // move render catergories/edit into the try block if successful and change "new Category" to category.
          } catch(err) {
             res.redirect('/categories');                                                   // and if there is an error, redirect to categories page.
          }
        });        
        -----------------------------------------------------------------------------------

25.4: Create an edit page in views/categories called edit.ejs:
        -----------------------------------------------------------------------------------
                edit.ejs
        -----------------------------------------------------------------------------------

25.5: Copy and paste the new.ejs code into the edit.ejs since it is basically the same:
        -----------------------------------------------------------------------------------
        <h2>Edit Category</h2>
        <form action="/categories/<%= category.id %>?_method=PUT" method="POST">             // add category id so we get the update action (instead of the new action) and add the method override method.
        <a href="/categories">Cancel</a>
        <button type="submit">Update</button>
        </form>
        -----------------------------------------------------------------------------------

25.6: Reroute cancel from categories to the category page.
        -----------------------------------------------------------------------------------
        <h2>Edit Category</h2>
        <form action="/categories/<%= category.id %>?_method=PUT" method="POST">            
        <a href="/categories/<%= category.id %>">Cancel</a>                                    // add category.id to bring back to categoyr if canceled
        <button type="submit">Update</button>
        </form>
        -----------------------------------------------------------------------------------


Phase 26: Create Update page
============================================================================================
* Update page will allow you to update the existing information saved to the database.
  Note that the update page is going to be very similar to the create page so keep that 
  in mind.
============================================================================================

26.1: Copy and paste the update route to the update categories route.
        ------------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
         const category = new Category({
         name: req.body.name
         });
         try {
          const newCategory = await category.save()   
         // res.redirect(`categories/${newCategory.id}`);
          res.redirect(`categories`);
         } catch(err) {
          res.render('categories/new', {
          category: category,
          errorMessage: 'Error creating category'
          });    
         }    
        });
        ------------------------------------------------------------------------------------

26.2: Get the existing category in the try block and, if successful
         ------------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
         const category = new Category({
         name: req.body.name
         });
         try {
          category = await Category.findById(req.params.id);                                         // category is equal to Category id (get input from user). This uses the mongo databse
          await category.save()                                                                        to get the category by id and save it in the line below.
         // res.redirect(`categories/${newCategory.id}`);
          res.redirect(`categories`);
         } catch(err) {
          res.render('categories/new', {
          category: category,
          errorMessage: 'Error creating category'
          });    
         }    
        });
        ------------------------------------------------------------------------------------       


26.3: Redirect to categories/id and remove redirect to categories.
         ------------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
         const category = new Category({
         name: req.body.name
         });
         try {
          category = await Category.findById(req.params.id);                             
          await category.save()                                                             
          res.redirect(`categories/${catgory.id}`);                                          // uncomment and redirect to "category.id".
                                                                                         
         } catch(err) {
          res.render('categories/new', {
          category: category,
          errorMessage: 'Error creating category'
          });    
         }    
        });
        ------------------------------------------------------------------------------------       

26.4: (for end of phase 15), uncomment redirect to newCategory.id and remove redirect to categories for create category route.
        ------------------------------------------------------------------------------------
        same as above but for create category route
        ------------------------------------------------------------------------------------

26.5: Remove "create new Category" and create a new variable called "category".
=================================================================================
Note that you need to remove the create new Category route, replace it withy a variable
called "category" BUT make sure to have it outside the try block because the catch block
need to access to that variable as well.  The reason why is that it could fail when you 
try to get the categoyr AND when you try to save the category.
=================================================================================
        -----------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
          let category;                                                             // replaced create new category with category variable.
          try {
            category = await Category.findById(req.params.id);
            await category.save()   
            res.redirect(`categories/${category.id}`);
         } catch(err) {
           res.render('categories/new', {
           category: category,
           errorMessage: 'Error creating category'
           });    
          }    
        });
        -----------------------------------------------------------------------------------

26.6: Add an if statement inside the catch to see if the category is equal to null
======================================================================================
* If category is equal to null, then that means that the the failure occured trying to 
get the category. In this case, just redirect to the homepage.
======================================================================================
        -----------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
        let category;
        try {
        category = await Category.findById(req.params.id);
        await category.save()   
        res.redirect(`categories/${category.id}`);
        } catch(err) {
        if (category == null) {                                                            // if null, redirect to the homepage
        res.redirect('/');
        }
        res.render('categories/new', {
        category: category,
        errorMessage: 'Error creating category'
        });    
        }    
        });
        -----------------------------------------------------------------------------------

26.7: Change new to edit in the res.render and the error message to "errror creating category".
        -----------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
        let category;
        try {
        category = await Category.findById(req.params.id);
        await category.save()   
        res.redirect(`categories/${category.id}`);
        } catch(err) {
        if (category == null) {
        res.redirect('/');
        }
        res.render('categories/edit', {                                                     // redirect to edit
        category: category,
        errorMessage: 'Error creating category'                                            // edit message
        });    
        }    
        });
        -----------------------------------------------------------------------------------

26.8: Add an else statement to route if successful and relocate successful route inside.
        -----------------------------------------------------------------------------------
        // Update categories route
        router.put('/:id', async function(req, res) {          
        let category;
        try {
        category = await Category.findById(req.params.id);
        await category.save()   
        res.redirect(`/categories/${category.id}`);                                      // backslash error (!!!!)
        } catch(err) {
        if (category == null) {
        res.redirect('/');
        } else {                                                                         // else statement with successful route
        res.render('categories/edit', {
        category: category,
        errorMessage: 'Error updating category'
        });  
        } 
        }    
        });
        -----------------------------------------------------------------------------------

26.9: To show the result of your editing, 
===========================================================================================
* Because all that has been done in the edit route is get and save, there is still no instruction
that will change the category name so that it reflects in the application. What this will do is
chnage the name BEFORE you save it.
===========================================================================================
-------------------------------------------------------------------------------------------
// Update categories route
router.put('/:id', async function(req, res) {          
  let category;
  try {
    category = await Category.findById(req.params.id);
    category.name = req.body.name;                                                             // for the category.name, change it (before saving it.)
    await category.save()   
    res.redirect(`/categories/${category.id}`);
  } catch(err) {
    if (category == null) {
      res.redirect('/');
    } else {
      res.render('categories/edit', {
      category: category,
      errorMessage: 'Error updating category'
    });  
    } 
  }    
});

-------------------------------------------------------------------------------------------


Phase 27: Create Delete page
==========================================================================================
* The delete function is going to allow you to remove the category from the categories page.
  To do this, you are going to use almost exactly the same logic as the update route. In fact,
  you can copy and paste the update route and change a few things aroung and you will be done!
==========================================================================================

27.1: Copy and paste delete funcitonality and change:
        ------------------------------------------------------------------------------------
        // Delete categories route
        router.delete('/:id', async function(req, res) {
        let category;
        try {
        category = await Category.findById(req.params.id);
                                                                        // remove because you dont need to worry about updating the author name.
        await category.remove()                                         // remove instead of save.
        res.redirect(`/categories`);  
        } catch(err) {
        if (category == null) {
        res.redirect('/');
        } else {
        res.redirect(`/categories/${category.id}`);  
        } 
        }   
        });
        ------------------------------------------------------------------------------------


Phase 28: Create a pre method to account for issues using categories you may still be using.
==================================================================================================
* IN the category model, you can use mongoose to run code before, drueing, or after a certain actions.
 in this case, we want to add a ".pre" action before the action occurs.
==================================================================================================
        
28.1: Include the Issue model in the category model:
        --------------------------------------------------------------------------------------
        const Issue = required('./issue');
        --------------------------------------------------------------------------------------


28.2: create a pre method to account for deletion of category IF issues may be using that category
===================================================================================================
* pre allows you to run an action before the method occurs, and pass "remove" and a function with 
  the callback "next", which will mean it is ok to move forward unless it is an error.
===================================================================================================
        --------------------------------------------------------------------------------------
        categorySchema.pre('remove', function(next) {   
        Issue.find({category: this.id}, function (err, issues) {                               // if any issues for this catgory
        if(err) {                                                                              // if error...
        next(err);                                                                             // pass the error on (an prevent you from removing )
        } else if (issues.length > 0) {                                                        // for the particular issue, if there are issues for the category, do NOT remove the category.
        next(new Error('This category still has issues'))
        } else {                                                                               // but if no errors and no issues, then
        next();                                                                                // then next and remove the category.
        }
        });    
        });
        --------------------------------------------------------------------------------------



Phase 29: Create show categories page
====================================================================================================
* Note, when you create 
====================================================================================================

29.1: Create a "show.ejs" file in views/categories:
        -------------------------------------------------------------------------------
        views  >  categories  >  show.ejs
        -------------------------------------------------------------------------------

29.2: Create initial layout for individual categories:
        --------------------------------------------------------------------------------------------
        <h2> <%= category.name %> </h2>                                                          // category name for the title
        <a href="/categories/<%= category.id %>/edit">Edit</a>                                  // edit link -- route to categories/category id/edit
        <%- include('../partials/deleteForm', {url: `/categories/${category.id}`}) %>           // use delete partial and include going back one folder (../) and add route to delee form file, and pass in url
        --------------------------------------------------------------------------------------------

29.3: Add issues by category:
        ------------------------------------------------------------------------------------------
        <h2> <%= category.name %> </h2>                     
        <a href="/categories/<%= category.id %>/edit">Edit</a>      
        <%- include('../partials/deleteForm', {url: `/categories/${category.id}`}) %>       

        <% if (issuesByCategory.length > 0) { %>                                                        // if the issuseByCategory length is greater than 0, show issues.
        <h2>Issues by Category</h2>

        <% } %> 
        ------------------------------------------------------------------------------------------

29.4: Copy over issues logic that loops through each issue.
        -----------------------------------------------------------------------------------------
        <h2> <%= category.name %> </h2>                     
        <a href="/categories/<%= category.id %>/edit">Edit</a>      
        <%- include('../partials/deleteForm', {url: `/categories/${category.id}`}) %>       

        <% if (issuesByCategory.length > 0) { %>         
        <h2>Issues by Category</h2>
        <% issuesByCategory.forEach( function(issue) {  %>                                                // will print out each issue in issueByCategory
        <div><%= issue.title %></div>
        <% }) %>
        <% } %> 
        -----------------------------------------------------------------------------------------


29.5: Configure route for show category with associated issues:
        -----------------------------------------------------------------------------------------
        // Show categories
        router.get('/:id', async function (req, res) {                                              // add async to callback
        try {                                                                                        // add try/catch blocks

        } catch(err) {
        
        }
        
        res.send('Show Category ' + req.params.id);   
        });    
        -----------------------------------------------------------------------------------------

29.6: Add logic:
        -------------------------------------------------------------------------------------------
        // Show categories
        router.get('/:id', async function (req, res) {     
        try {
        const category = await category.findById(req.params.id);                                       // get category by id
        const issues = await issues.find({category: category.id}).exec();                              // find issues by a particular category and limit the amount you want to get with .limit(if you want to) and execute.
        res.render('categories/show', {category: category, issuesByCategory: issues})                  // if both of the above are true, then 
        } catch(err) {
        res.redirect('/');                                                                             redirect to main page if issue.
        }  
        });               
        -------------------------------------------------------------------------------------------




Phase 30: Create show route
======================================================================================================
* Remember for the show route you need to define this AFTER the new route.
======================================================================================================

30.1: Create show route in issues.js
        ---------------------------------------------------------------------------------------------    
        // Show Route
        router.get('/:id', async function(req, res) {
        
        });
        ---------------------------------------------------------------------------------------------

30.2: Define how we'll get the issue and show it on the page:
        ---------------------------------------------------------------------------------------------
        // Show Route
        router.get('/:id', async function(req, res) {
        try {
        const issue = await Issue.findById(req.params.id)
                                .populate('category')
                                .exec()                                                        // find the issue by id and use populate to find the collection to populate, which in this case is Category... so what this will do is populate the "category" variable inside the Issue object with all Category information.... and then execute.
        res.render('issues/show', {issue: issue})                                              // and make the response render issues/show and pass in the 
        } catch(err) {
        res.redirect('/');                                                                     // if failed, redirect to the homepage.
        }
        });

        ---------------------------------------------------------------------------------------------

30.3: Create the view for the show route with initial title for test:
        --------------------------------------------------------------------------------------------
        <h2><%= issue.title  %></h2>
        --------------------------------------------------------------------------------------------

30.4: Make the title each of the issues into a link with an anchor tag:
        --------------------------------------------------------------------------------------------
        <h2>Search Issues</h2> 
        <form action="/issues" method="GET"> 
        <div>
        <label>Title</label> 
        <input type="text" name="title" value="<% searchOptions.title %>"> 
        </div>
        <button type="submit">Search</button>
        </form>
        <br>
        <div>
        <% issues.forEach( function(issue) {  %>
        <a href="/issues/<%= issue.id %>">                                                 // anchor tag has as an href the url to the page we just created (show issues) 
        <div><%= issue.title %></div>
        </a>
        <% }) %>
        </div>
        --------------------------------------------------------------------------------------------

30.5: In the view for show route, add in feature content
==============================================================================
* Note here that when you addedf the .populate in 30.2, which preloads all the 
 category information BEFORE it returns the issue. Otherwise it would just be an
 id but now it is an OBJECT.
==============================================================================
        -------------------------------------------------------------------------------------------- 
        <h2><%= issue.title  %></h2>
        <img width="150" height="100" src="<%= issue.imagePath %>" alt="">                          // image with small size so its easier to work with.
        <div>Category: <%= issue.category.name %></div>                                              // category information from note above.
        <div>Issue created: <%= issue.createdAt.toDateString() %></div>                             // date of issue creation with toDateString so you only get the information you want
        <div>Description: <%= issue.description %></div>                                            // descroption
        <div>Solution: <%= issue.solution %></div>                                                  // solution
        -------------------------------------------------------------------------------------------- 


30.6: Add in links for edit, delete, and view category:
==================================================================================
* Note that only the view category link will work at this point because they routes
  have not been added for the edit and delete yet
==================================================================================
        --------------------------------------------------------------------------------------------
        <h2><%= issue.title  %></h2>
        <img width="150" height="100" src="<%= issue.imagePath %>" alt="">
        <div>Category: <%= issue.category.name %></div>
        <div>Issue created: <%= issue.createdAt.toDateString() %></div>
        <div>Description: <%= issue.description %></div>
        <div>Solution: <%= issue.solution %></div>

        <a href="/issues/<%= issue.id %>/edit">Edit</a>                                             // link to edit
        <%- include('../partials/deleteForm', { url: `/issues/${issue.id}`}) %>                    // remember to use the hyphen and pass path and params
        <a href="/categories/<%= issue.category.id %>">View Category</a>                            // link to category
        --------------------------------------------------------------------------------------------

30.7: Define edit route
====================================================================================
* Copy-and-paste the new issue route from issues.js so you dont have to do extra work.
====================================================================================
        --------------------------------------------------------------------------------------------
        //Edit Issue Route
        router.get('/new', async function(req, res) {
        renderNewPage(res, new Issue());
        });
        --------------------------------------------------------------------------------------------
        --------------------------------------------------------------------------------------------
        router.get('/:id/edit', async function(req, res) {                                             // edit the path to access the id and edit
          try {                                                                                        // add try/catch block
           const issue = await Issue.findById(req.params.id);                                          // get the issue by awaiting the Issue and finding by ID
           renderEditPage(res, issue);                                                                 // change new to edit and get the issue rather than create a "new" issue
        } catch(err) {
        res.redirect('/')
        }   
        });
        --------------------------------------------------------------------------------------------

30.8: Create renderEditPage route:
=========================================================================================
* renderEditPage is almost exactly the same as renderNewPage so you can just copy/paste and
  alter the parts you need.
=========================================================================================
        --------------------------------------------------------------------------------------------
        // Render Edit Page function
        async function renderEditPage(res, issue, hasError = false) {                                 // update name
        try {
        const categories = await Category.find({}); 
        const params = {
        categories: categories,
        issue: issue
        }
        if (hasError) {
        params.errorMessage = 'Error Creating Issue';
        }
        // const issue = new Issue();
        res.render('issues/edit', params);                                                           // change "new" to "edit"         
        } catch (err) {
        res.redirect('/issues');  
        }
        }
        --------------------------------------------------------------------------------------------

30.9: However, because the renderNewPage and renderEditPage are identical, you can create a shared function for both:
=================================================================================================
* Copy and paste the edit function you just made and place it below!
=================================================================================================
        ---------------------------------------------------------------------------------
        // Render Edit Page function
        async function renderFormPage(res, issue, form, hasError = false) {                // chnage name and pass it the "form" variable.
        try {
        const categories = await Category.find({}); 
        const params = {
        categories: categories,
        issue: issue
        }
        if (hasError) {
        params.errorMessage = 'Error Creating Issue';
        }
        res.render(`issues/${form}`, params);                                             // use string interpolation and pass in form
        } catch (err) {
        res.redirect('/issues');  
        }
        }       
        --------------------------------------------------------------------------------
















Phase X: Deploy to App to Heroku
* testing with heroku git connection
==================================================================================================
* https://github.com/john-azzaro/Study-Cloud-Deployment-with-Heroku 2009
==================================================================================================
 
 STEP 1 - In heroku dashboard, click "New" > "Create New App"
 STEP 2 - Give the App a name
 STEP 3 - Click the "Github" connection
 STEP 4 - Connect app to github by finding the repository (will automatically update)
 STEP 5 - Go to settings > config vars > reveal config vars and put the key. this is in the env file and is DATABASE_URL
          The value for the key is going to come from Mongodb atlas.
STEP 6 - In mongodb Atlas, Either build a new cluster (and save the password) OR the password (i.e. mypassword123, abc123, etc... whatever you specify) 
STEP 7 - then in mongodb atlas, select the "connect your application".
STEP 8 - Then, you will get a connection string. copy this string into a document and replace the password with your own.\
STEP 9 - Paste in the connection string into the value of your config vars in mongodb and click "Add".
STEP 10 - You should have a working app at the heroku address (https://issueindex.herokuapp.com/)




Resources
==========
https://www.npmjs.com/package/express-ejs-layouts  -- ejs layouts file
https://scotch.io/tutorials/use-ejs-to-template-your-node-application  -- ejs layouts outline
https://www.includehelp.com/node-js/ejs-layouts.aspx  -- ejs layouts
https://stackoverflow.com/questions/38306569/what-does-body-parser-do-with-express -- body-parser sum